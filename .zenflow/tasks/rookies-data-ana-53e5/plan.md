# New feature


## Configuration
- **Artifacts Path**: `.zenflow/tasks/{task_id}`
the actual path should be substituted for {@artifacts_path}

---

## Workflow Steps

### [x] Step: Requirements
<!-- chat-id: ca1f8351-f83c-4408-a944-8e3f18605d84 -->

Your job is to generate a Product Requirements Document based on the feature description,

First, analyze the provided feature definition and determine unclear aspects.  For unclear aspects:
       - Make informed guesses based on context and industry standards
       - Only mark with [NEEDS CLARIFICATION: specific question] if:
         - The choice significantly impacts feature scope or user experience
         - Multiple reasonable interpretations exist with different implications
         - No reasonable default exists
      - Prioritize clarifications by impact: scope > security/privacy > user experience > technical details

Ask up to 5 most priority clarifications to the user. Then, create the document following this template:

```
# Feature Specification: [FEATURE NAME]


## User Stories*


### User Story 1 - [Brief Title]

**Acceptance Scenarios**:

1. **Given** [initial state], **When** [action], **Then** [expected outcome]
2. **Given** [initial state], **When** [action], **Then** [expected outcome]

---

## Requirements*

## Success Criteria*

```

Save the PRD into `{@artifacts_path}/requirements.md`.

### [x] Step: Technical Specification
<!-- chat-id: c1f848a5-3e46-4a33-9cbd-da38a8ee7d13 -->

Based on the PRD in `{@artifacts_path}/requirements.md`, create a detailed technical specification to be used by a coding agent to implement the feature. Follow this template:

```
# Technical Specification: [FEATURE]

## Technical Context
Language/Version, primary dependencies, etc

## Technical Implementation Brief

Summarize key technical decisions for implementing the feature. Make sure they take into account the existing code as much as possible.

## Source Code Structure

## Contracts

Define addition or changes in data models, DB schemas, APIs, code interfaces etc

## Delivery Phases

Define several incremental deliverables for the feature. Each should be a minimal viable product testable end-to-end.

## Verification Strategy 

Define how the coding agent can verify each deliverable it creates. Provide instructions for the agent to perform the verification using available tools (lint/test commands, bash commands) and create helper scripts and tools for more complex result verification.
The verification for each deliverable should be executable by a coding agent using built-in capabilities (lint and test commands from the project, bash commands), pre-generated helper scripts or MCP servers. Research and add to the spec:

- MCP servers that should be installed to help the agent with the verification 

- helper scripts that need to be generated in the first phases of the plan to verify complex scenarios that can't be covered by the tests in the project's test framework(s)

- any sample input artifact(s) that are required for verification. Note if these artifacts can be a) generated by the agent; b) discovered by the agent on line; c) must be provided by the user.
```

Save the spec to `{@artifacts_path}/spec.md`.

### [x] Step: Implementation Plan
<!-- chat-id: 102422cb-b36a-4aba-b81c-59d960a585ef -->

Based on the technical spec in `{@artifacts_path}/spec.md`, create a detailed task plan and update `{@artifacts_path}/plan.md`. Each task should have task definition, references to contracts to be used/implemented, deliverable definition and verification instructions.

Format each task as 
```
### [ ] Step: <task_name>
Task instructions
```

"Step:" prefix is important, do not omit it!

### [x] Step: Bootstrap CLI & IO
<!-- chat-id: 998c3686-b9a1-40d7-9bdb-cd95bf45ccdd -->
Task definition
- Implement CLI parsing in `scripts/generate_draft_class_analytics.py` with args: `--year <int>` (required), `--players`, `--teams`, `--out` and create parent dir for output.
- Implement helpers: `read_csv(path) -> list[dict]`, `safe_int(v, default=None) -> Optional[int]`.

Contracts to use
- Data contracts (inputs): `MEGA_players.csv`, `MEGA_teams.csv` headers presence as defined in spec.
- CLI interface (script contract): invocation and default paths.

Deliverables
- Updated `scripts/generate_draft_class_analytics.py` supporting required CLI and resilient file IO.

Verification
- Run: `python3 scripts/generate_draft_class_analytics.py --year 2026 --players MEGA_players.csv --teams MEGA_teams.csv --out docs/draft_class_2026.html`
- Confirm output directory creation and script summary printed.
- Check file exists: `test -s docs/draft_class_2026.html`.

### [x] Step: Rookie Filtering & Normalization
<!-- chat-id: 0aa06abb-aed5-4c7c-96e7-321f886f5198 -->
Task definition
- Implement `gather_rookies(players, year)` to filter `rookieYear == year` and normalize fields: `name`, `team` (default `FA`), `position` (default `?`), `ovr` (prefer `playerBestOvr` then `playerSchemeOvr`, default 0), `dev` (map unknown to 0).
- Name derivation order: `fullName` > `cleanName` > `firstName + lastName`.

Contracts to use
- Data contracts (inputs) and Dev trait mapping contract.

Deliverables
- Normalized in-memory list of rookies ready for analytics and rendering.

Verification
- Quick count from CSV vs function result by running the script and printing total rookies in summary.
- Sanity one-liner: compare CSV rookies vs HTML KPI total using ripgrep as defined in spec’s verification strategy.

### [x] Step: Team Logo Mapping
<!-- chat-id: e3b00b47-c970-4123-86df-79d871617244 -->
Task definition
- Implement `build_team_logo_map(teams_rows)` to map any of `displayName`, `nickName`, `teamName` to `logoId` and support logo URL generation `https://cdn.neonsportz.com/teamlogos/256/<logoId>.png`.
- Tolerate missing `MEGA_teams.csv` gracefully (no logos).

Contracts to use
- Data contracts (teams headers) and Output HTML contract (logos appear when resolvable).

Deliverables
- Logo mapping integrated into generation pipeline; logos rendered where possible.

Verification
- If teams file present: `rg -n "<img class=\"logo\"" docs/draft_class_2026.html` returns at least one match.
- If teams file absent/empty: page still renders without errors and without logos.

### [x] Step: Analytics Aggregations
<!-- chat-id: a56acf17-0745-44e8-850a-6af6d4fada42 -->
Task definition
- Implement `compute_analytics(rows)` to compute KPIs: total rookies, average OVR, dev distribution, elites share; and aggregates per team and per position with sorting rules from the spec.

Contracts to use
- Output HTML contract (required sections and metrics) and OVR fallback logic.

Deliverables
- Analytics dict consumed by HTML generator covering KPIs, team table data, position table data, elites spotlight lists.

Verification
- Run generator; validate KPIs in HTML:
  - `rg -n "Draft Class 2026 — Analytics Report" docs/draft_class_2026.html`
  - `rg -o "<b>Total rookies</b><span>(\\d+)" -r "$1" -N docs/draft_class_2026.html`
- Cross-check totals using CSV Python one-liner from spec.

### [x] Step: HTML Generation & Styling
<!-- chat-id: ee7721d0-7ee3-4137-a77f-596342dc0988 -->
Task definition
- Implement `generate_html(year, rows, analytics, team_logo_map)` to output a single self-contained HTML with inline CSS and sections: KPIs, Elites Spotlight (dev 3/2), Team Analytics, Most Hiddens, Position Analytics, Elite-heavy Positions.
- Ensure deterministic sorting and no unresolved placeholders remain.

Contracts to use
- Output HTML contract (no `__PLACEHOLDER__`, required sections present, logos optional), Dev trait mapping for badges.

Deliverables
- `docs/draft_class_2026.html` generated with specified sections and styling.

Verification
- `test -s docs/draft_class_2026.html`
- `! rg -n "__[A-Z_]+__" docs/draft_class_2026.html`
- Spot-check elites cards exist only for dev in {2,3} via text search for badges.

### [x] Step: Verification Helper Script
<!-- chat-id: d1966662-0a8b-4ddb-81e2-d00287915e5e -->
Task definition
- Create `scripts/verify_draft_class_analytics.py` that recomputes counts from CSV for a given year and asserts HTML KPIs and placeholders, exiting non-zero on mismatches.

Contracts to use
- Data contracts, CLI interface (accept year and optional paths), Output HTML contract.

Deliverables
- New verification script in `scripts/` with usage: `python3 scripts/verify_draft_class_analytics.py 2026 --players MEGA_players.csv --teams MEGA_teams.csv --html docs/draft_class_2026.html`.

Verification
- Run end-to-end: generate HTML then run the verifier; it should exit 0 and print a concise pass summary.

### [x] Step: Smoke Test Script
<!-- chat-id: f511d9fb-ec49-4379-aeef-22f55a33b770 -->
Task definition
- Create `scripts/smoke_generate_draft_2026.sh` to run generation for 2026 and then the verification script.
- Make script executable and fail-fast on any error.

Contracts to use
- CLI interface, Verification Strategy commands from spec.

Deliverables
- Executable smoke script that returns non-zero on failure and prints output locations.

Verification
- `bash scripts/smoke_generate_draft_2026.sh` completes successfully and exits 0.

### [x] Step: Resilience & UX Polish
<!-- chat-id: 728164d9-56f0-43fb-844b-c264a340a87f -->
Task definition
- Improve error messages and exit codes for missing files/columns, add safe fallbacks, ensure readable badges and table layouts.
- Optional: add `--league-prefix` or title override per spec.

Contracts to use
- CLI interface stability and Output HTML contract (robustness expectations).

Deliverables
- Hardened script behavior with clear errors and documented fallbacks; optional CLI for title/branding.

Verification
- Run with missing `--teams` file to ensure graceful logo omission.
- Run with corrupt numeric fields to ensure defaults used and page still renders.

### [x] Step: Documentation Update
<!-- chat-id: d41eb7ae-e66e-4614-801f-2a28155b1550 -->
Task definition
- Add a README section “Draft Class Analytics” with usage, arguments, outputs, and verification commands.

Contracts to use
- Refer to CLI interface and Verification Strategy from spec.

Deliverables
- Updated `README.md` with concise instructions and example commands.

Verification
- Open `README.md` and confirm section exists with accurate commands; optionally run commands to validate.

### [x] Step: hide elits
<!-- chat-id: cbcb6185-48a5-44da-b0bc-cc40e38000fc -->

We need to do a refactoring to hide the real dev trait, if its 3 2 or 1 we show its as a Hiden, if its normal we showing as a normal. 

Update representation and documentations

### [x] Step: Elites Spotlight — X-Factors and Superstars
<!-- chat-id: 13d48387-273f-4f89-be17-fd5a3013d309 -->

we need to show the pick where they picked like 
Cardinals Clyde Stackhouse HB · Cardinals OVR 85 round 1 pick 8 and etc

Implemented: Elite cards now include draft round and pick (derived from `draftRound` and `draftPick` in `MEGA_players.csv`) appended to the OVR line, e.g., `OVR 85 round 1 pick 8`. Dev tiers remain masked (Hidden/Normal) per prior step.

### [x] Step: Add new graphic Round hidden
<!-- chat-id: bca2fdcf-19cd-4ad9-bb5a-6b0cdc5d6817 -->

In wich round team select a hidden? We need to have representation of Hit and miss, like for example Dallas select 3 hiddens in 1st round, and 0 in other rounds and etc

### [ ] Step: Change Design

Right now design of our HTML looks super simple, lets made it better, Do your best, but not overcomplicated. You can look on other HTMLs to understand our styling
