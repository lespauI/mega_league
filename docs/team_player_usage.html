<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team Player Usage Patterns</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    :root {
      --red: #ef4444;
      --blue: #0ea5e9;
      --grid: #e8eaed;
      --axis: #9aa0a6;
      --text: #222;
    }
    body { margin: 16px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text); background: #f7f7f7; }
    .container { max-width: 1200px; margin: 0 auto; background: #fff; border: 1px solid #e5e5e5; border-radius: 10px; padding: 12px 16px 22px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    .subtitle { color: #666; font-size: 13px; margin: 4px 0 12px; }
    .controls { display: flex; align-items: center; gap: 10px; margin: 6px 0 8px; }
    .panel { margin: 12px 0 14px; border: 1px solid #e5e5e5; border-radius: 10px; overflow: hidden; background: #fff; }
    .panel > summary { padding: 10px 14px; background: #f5f7fa; border-bottom: 1px solid #ebeff5; font-weight: 600; cursor: pointer; user-select: none; list-style: none; }
    .panel[open] > summary { border-bottom-color: #e6eaf0; }
    .chart-wrap { padding: 8px 8px 0; }
    .legend { display: flex; align-items: center; gap: 16px; color: #555; font-size: 12px; padding: 0 10px 10px; }
    .swatch { display: inline-block; width: 12px; height: 12px; border-radius: 2px; margin-right: 6px; vertical-align: middle; }
    .avg { background: repeating-linear-gradient(90deg, #bbb, #bbb 2px, transparent 2px, transparent 6px); border: 1px solid #bbb; }
    .red { background: var(--red); opacity: .5; }
    .blue { background: var(--blue); opacity: .5; }
    .tooltip { position: absolute; pointer-events: none; background: rgba(0,0,0,.78); color: #fff; padding: 6px 8px; border-radius: 6px; font-size: 12px; z-index: 10; }
    .info { background: #f3f6fa; border: 1px solid #e1e7ef; border-radius: 8px; padding: 10px 14px; color: #243246; font-size: 14px; margin: 8px 0 12px; }
    .correlation-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
    .corr-strong { background: #dcfce7; color: #166534; }
    .corr-moderate { background: #fef3c7; color: #854d0e; }
    .corr-weak { background: #fee2e2; color: #991b1b; }
    .help-icon { display: inline-block; width: 16px; height: 16px; border-radius: 50%; background: #3b82f6; color: white; text-align: center; line-height: 16px; font-size: 11px; font-weight: bold; margin-left: 8px; cursor: help; vertical-align: middle; }
    .metric-tooltip { position: absolute; pointer-events: none; background: rgba(30,64,175,.95); color: #fff; padding: 8px 12px; border-radius: 6px; font-size: 12px; z-index: 100; max-width: 350px; line-height: 1.5; box-shadow: 0 4px 6px rgba(0,0,0,.3); }
  </style>
  <script>
    async function tryCsv(paths) {
      let lastErr;
      for (const p of paths) {
        try { return await d3.csv(p, d3.autoType); } catch (e) { lastErr = e; }
      }
      throw lastErr || new Error('Unable to load CSV: ' + paths.join(', '));
    }

    function fmt1(x) { return d3.format('.1f')(x); }
    function fmt2(x) { return d3.format('.2f')(x); }
    function fmt3(x) { return d3.format('.3f')(x); }
    function toPct(x) { return d3.format('.1%')(x); }
    function toPct0(x) { return d3.format('.0%')(x); }

    function regression(points) {
      let n = 0, sx = 0, sy = 0, sxy = 0, sxx = 0, syy = 0;
      for (const [x0, y0] of points) {
        const x = +x0, y = +y0;
        if (!Number.isFinite(x) || !Number.isFinite(y)) continue;
        n++; sx += x; sy += y; sxy += x*y; sxx += x*x; syy += y*y;
      }
      if (n < 2) return { m: 0, b: sy / (n || 1), r2: 0 };
      const denom = n * sxx - sx * sx;
      const m = denom !== 0 ? (n * sxy - sx * sy) / denom : 0;
      const b = (sy - m * sx) / n;
      
      const ssr = points.reduce((sum, [x0, y0]) => {
        const x = +x0, y = +y0;
        if (!Number.isFinite(x) || !Number.isFinite(y)) return sum;
        return sum + Math.pow(y - (m * x + b), 2);
      }, 0);
      const sst = syy - (sy * sy) / n;
      const r2 = sst !== 0 ? Math.max(0, 1 - ssr / sst) : 0;
      
      return { m, b, r2 };
    }

    async function loadData() {
      const stats = await tryCsv([
        '../output/team_player_usage.csv',
        'output/team_player_usage.csv',
        '/output/team_player_usage.csv'
      ]);

      for (const row of stats) {
        row.logoUrl = (row.logoId !== '' && row.logoId != null) ? 
          `https://cdn.neonsportz.com/teamlogos/256/${row.logoId}.png` : null;
      }

      return stats;
    }

    function drawScatter(holder, rows, cfg) {
      rows = rows.filter(d => 
        Number.isFinite(+d[cfg.xKey]) && Number.isFinite(+d[cfg.yKey])
      );

      if (rows.length < 2) return;

      const margin = { top: 20, right: 24, bottom: 46, left: 70 };
      const width = 1080, height = 480;
      const innerW = width - margin.left - margin.right;
      const innerH = height - margin.top - margin.bottom;

      const panel = holder.append('details').attr('class', 'panel').attr('open', true);
      const summary = panel.append('summary');
      summary.append('span').text(cfg.title);
      
      if (cfg.metricHelp) {
        const helpIcon = summary.append('span').attr('class', 'help-icon').text('?');
        const metricTip = d3.select('body').append('div').attr('class', 'metric-tooltip').style('display', 'none');
        helpIcon.on('mouseenter', function(evt) {
          metricTip.style('display', 'block').html(cfg.metricHelp);
        }).on('mousemove', (evt) => {
          metricTip.style('left', (evt.pageX + 12) + 'px').style('top', (evt.pageY - 28) + 'px');
        }).on('mouseleave', () => {
          metricTip.style('display', 'none');
        });
      }
      
      const wrap = panel.append('div').attr('class', 'chart-wrap');
      const svg = wrap.append('svg').attr('width', width).attr('height', height);
      const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

      const yVals = rows.map(d => +d[cfg.yKey]);
      const yMin = d3.min(yVals), yMax = d3.max(yVals);
      const yRange = yMax - yMin;
      const yPad = yRange * 0.15 || 0.5;
      const y = d3.scaleLinear()
        .domain([yMin - yPad, yMax + yPad])
        .range([innerH, 0]);

      const xVals = rows.map(d => +d[cfg.xKey]);
      const xMin = d3.min(xVals), xMax = d3.max(xVals);
      const xRange = xMax - xMin;
      const xPad = xRange * 0.15 || 0.5;
      const x = d3.scaleLinear()
        .domain([xMin - xPad, xMax + xPad])
        .range([0, innerW]);

      g.append('g').attr('transform', `translate(0,${innerH})`)
        .call(d3.axisBottom(x).ticks(10).tickFormat(cfg.xFormat || fmt2).tickSize(-innerH).tickPadding(8))
        .call(s => s.selectAll('.tick line').attr('stroke', '#e2e2e2'))
        .call(s => s.select('.domain').attr('stroke', '#9aa0a6'));

      g.append('g')
        .call(d3.axisLeft(y).ticks(10).tickFormat(cfg.yFormat || fmt2).tickSize(-innerW).tickPadding(6))
        .call(s => s.selectAll('.tick line').attr('stroke', '#efefef'))
        .call(s => s.select('.domain').attr('stroke', '#dcdcdc'));

      const yAvg = d3.mean(yVals), xAvg = d3.mean(xVals);
      g.append('line').attr('x1', 0).attr('x2', innerW).attr('y1', y(yAvg)).attr('y2', y(yAvg))
        .attr('stroke', '#999').attr('stroke-dasharray', '6,4').attr('stroke-width', 1.5);
      g.append('line').attr('x1', x(xAvg)).attr('x2', x(xAvg)).attr('y1', 0).attr('y2', innerH)
        .attr('stroke', '#9aa0a6').attr('stroke-dasharray', '6,4').attr('stroke-width', 1.5);
      g.append('text').attr('x', 6).attr('y', y(yAvg)-6).attr('fill', '#555').attr('font-size', 11)
        .text('Avg Y: ' + (cfg.yFormat || fmt2)(yAvg));
      g.append('text').attr('x', x(xAvg)+6).attr('y', 12).attr('fill', '#555').attr('font-size', 11)
        .text('Avg X: ' + (cfg.xFormat || fmt2)(xAvg));

      const { m, b, r2 } = regression(rows.map(d => [+d[cfg.xKey], +d[cfg.yKey]]));
      const xRangePts = [d3.min(xVals), d3.max(xVals)];
      g.append('line')
        .attr('x1', x(xRangePts[0])).attr('y1', y(m*xRangePts[0] + b))
        .attr('x2', x(xRangePts[1])).attr('y2', y(m*xRangePts[1] + b))
        .attr('stroke', '#777').attr('stroke-width', 2).attr('opacity', .95);

      const tip = d3.select('body').append('div').attr('class', 'tooltip').style('display', 'none');

      const size = 30;
      const node = g.selectAll('.team').data(rows, d => d.team).join('g').attr('class', 'team')
        .attr('transform', d => `translate(${x(d[cfg.xKey])},${y(d[cfg.yKey])})`)
        .on('mouseenter', function(evt, d){
          const trend = m * d[cfg.xKey] + b;
          const res = d[cfg.yKey] - trend;
          let html = `<strong>${d.team}</strong><br>`;
          html += `${cfg.xLabel}: ${(cfg.xFormat || fmt2)(d[cfg.xKey])}<br>`;
          html += `${cfg.yLabel}: ${(cfg.yFormat || fmt2)(d[cfg.yKey])}<br>`;
          html += `Win%: ${toPct(d.win_pct)}<br>`;
          if (cfg.extraInfo) html += cfg.extraInfo(d) + '<br>';
          html += `Œî vs trend: ${(res>=0?'+':'') + fmt2(res)}<br>`;
          
          const qx = +d[cfg.xKey] >= xAvg;
          const qy = +d[cfg.yKey] >= yAvg;
          let quadrant = '';
          if (cfg.quadrantHelp) {
            if (qx && qy) quadrant = '<em>' + cfg.quadrantHelp.topRight + '</em>';
            else if (!qx && qy) quadrant = '<em>' + cfg.quadrantHelp.topLeft + '</em>';
            else if (!qx && !qy) quadrant = '<em>' + cfg.quadrantHelp.bottomLeft + '</em>';
            else quadrant = '<em>' + cfg.quadrantHelp.bottomRight + '</em>';
          } else {
            if (qx && qy) quadrant = '<em>–ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π: –≤—ã—Å–æ–∫–∏–π X, –≤—ã—Å–æ–∫–∏–π Y</em>';
            else if (!qx && qy) quadrant = '<em>–õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π: –Ω–∏–∑–∫–∏–π X, –≤—ã—Å–æ–∫–∏–π Y</em>';
            else if (!qx && !qy) quadrant = '<em>–õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π: –Ω–∏–∑–∫–∏–π X, –Ω–∏–∑–∫–∏–π Y</em>';
            else quadrant = '<em>–ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π: –≤—ã—Å–æ–∫–∏–π X, –Ω–∏–∑–∫–∏–π Y</em>';
          }
          html += quadrant;
          
          tip.style('display','block').html(html);
        })
        .on('mousemove', (evt)=> tip.style('left', (evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px'))
        .on('mouseleave', ()=> tip.style('display','none'));

      node.append('rect')
        .attr('x', -(size/2 + 2)).attr('y', -(size/2 + 2))
        .attr('width', size + 4).attr('height', size + 4)
        .attr('rx', 4).attr('ry', 4)
        .attr('fill', d => (+d[cfg.yKey] >= m*+d[cfg.xKey] + b) ? 'var(--red)' : 'var(--blue)')
        .attr('opacity', .16);

      node.append('image')
        .attr('href', d => d.logoUrl || null)
        .attr('x', -size/2).attr('y', -size/2)
        .attr('width', size).attr('height', size)
        .attr('opacity', .95);

      svg.append('text').attr('x', margin.left + innerW/2).attr('y', height-10)
        .attr('text-anchor', 'middle').attr('fill', '#444').attr('font-size', 12)
        .text(cfg.xLabel);
      svg.append('text').attr('transform', `translate(14, ${margin.top + innerH/2}) rotate(-90)`)
        .attr('text-anchor', 'middle').attr('fill', '#444').attr('font-size', 12)
        .text(cfg.yLabel);

      const legend = panel.append('div').attr('class', 'legend');
      legend.append('span').html('<span class="swatch red"></span> Above Trend');
      legend.append('span').html('<span class="swatch blue"></span> Below Trend');
      legend.append('span').html('<span class="swatch avg"></span> Average Lines');
      
      let corrClass = 'corr-weak', corrLabel = 'Weak';
      if (r2 >= 0.5) { corrClass = 'corr-strong'; corrLabel = 'Strong'; }
      else if (r2 >= 0.25) { corrClass = 'corr-moderate'; corrLabel = 'Moderate'; }
      
      summary.append('span').attr('class', `correlation-badge ${corrClass}`)
        .style('margin-left', '12px')
        .html(`R¬≤=${fmt3(r2)} (${corrLabel})`);

      if (cfg.insight) {
        panel.append('div').style('padding', '8px 14px 10px').style('font-size', '13px')
          .style('color', '#555').style('font-style', 'italic').text('üí° ' + cfg.insight);
      }
    }

    function render() {
      loadData().then(allRows => {
        const charts = [
          {
            xKey: 'wr1_share',
            yKey: 'win_pct',
            xLabel: 'WR1 Target Share (%)',
            yLabel: 'Win Percentage',
            xFormat: fmt1,
            yFormat: toPct,
            title: 'Star Receiver Dependency',
            insight: 'Do teams need a dominant WR1 to win? Or is spreading the ball better?',
            extraInfo: d => `WR1: ${d.wr1_name} (${d.wr1_position})`,
            metricHelp: '<strong>WR1 Target Share:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—á, –±—Ä–æ—à–µ–Ω–Ω—ã—Ö –≥–ª–∞–≤–Ω–æ–º—É WR –∫–æ–º–∞–Ω–¥—ã –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø–µ—Ä–µ–¥–∞—á. –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç (>30%) = –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∑–≤–µ–∑–¥—ã.',
            quadrantHelp: {
              topRight: '‚≠ê –ó–≤—ë–∑–¥–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç - –±–æ–ª—å—à–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç WR1 + –º–Ω–æ–≥–æ –ø–æ–±–µ–¥',
              topLeft: 'üéØ –£—Å–ø–µ—Ö —á–µ—Ä–µ–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ - –º—è—á —Ä–∞—Å–∫–∏–¥–∞–Ω, –Ω–æ –ø–æ–±–µ–¥ –º–Ω–æ–≥–æ',
              bottomLeft: 'üòî –ù–µ—Ç –∑–≤–µ–∑–¥—ã –∏ –ø–æ–±–µ–¥ –º–∞–ª–æ - –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø–∞—Å–æ–≤–æ–π –∏–≥—Ä–µ',
              bottomRight: 'ü§î –ü–∞—Ä–∞–¥–æ–∫—Å: –µ—Å—Ç—å –∑–≤–µ–∑–¥–∞ WR1, –Ω–æ –º–∞–ª–æ –ø–æ–±–µ–¥ - –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º—ã –≤ –¥—Ä—É–≥–∏—Ö –∑–æ–Ω–∞—Ö'
            }
          },
          {
            xKey: 'te_target_share',
            yKey: 'win_pct',
            xLabel: 'TE Target Share (%)',
            yLabel: 'Win Percentage',
            xFormat: fmt1,
            yFormat: toPct,
            title: 'Tight End Usage vs Winning',
            insight: 'Elite TEs are game-changers. Do teams that feature their TE win more?',
            extraInfo: d => `TE1: ${d.te1_name || 'N/A'}`,
            metricHelp: '<strong>TE Target Share:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏—ë–º–æ–≤ —Ç–∞–π—Ç-—ç–Ω–¥–æ–º –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø—Ä–∏—ë–º–æ–≤ –∫–æ–º–∞–Ω–¥—ã. –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç (>20%) = TE –∫–∞–∫ –≥–ª–∞–≤–Ω–æ–µ –æ—Ä—É–∂–∏–µ –≤ –ø–∞—Å–æ–≤–æ–π –∏–≥—Ä–µ.'
          },
          {
            xKey: 'rb_target_share',
            yKey: 'win_pct',
            xLabel: 'RB Target Share (% of catches)',
            yLabel: 'Win Percentage',
            xFormat: fmt1,
            yFormat: toPct,
            title: 'Running Back Receiving Usage',
            insight: 'Pass-catching RBs create mismatches. Does featuring RBs in passing game correlate with wins?',
            extraInfo: d => `RB1: ${d.rb1_name}, RB2: ${d.rb2_name || 'N/A'}`,
            metricHelp: '<strong>RB Target Share:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏—ë–º–æ–≤ RB –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø—Ä–∏—ë–º–æ–≤. –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç (>25%) = –∞–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RB –≤ –ø–∞—Å–æ–≤–æ–π –∏–≥—Ä–µ –∏–ª–∏ —Å–±—Ä–æ—Å –º—è—á–∞ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º.'
          },
          {
            xKey: 'pass_concentration',
            yKey: 'win_pct',
            xLabel: 'Pass Concentration (Herfindahl Index)',
            yLabel: 'Win Percentage',
            xFormat: fmt1,
            yFormat: toPct,
            title: 'Passing Target Distribution',
            insight: 'Concentrated (high) = one star. Spread (low) = balanced. Which strategy wins more?',
            extraInfo: d => `Top 3: ${d.wr1_name}, ${d.wr2_name || 'N/A'}, ${d.wr3_name || 'N/A'}`,
            metricHelp: '<strong>Herfindahl Index:</strong> –ò–Ω–¥–µ–∫—Å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á (0-10000). >1500 = –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –Ω–∞ –æ–¥–Ω–æ–º –∏–≥—Ä–æ–∫–µ, 1000-1500 = –±–∞–ª–∞–Ω—Å, <1000 = —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –º–Ω–æ–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏.'
          },
          {
            xKey: 'rb1_share',
            yKey: 'win_pct',
            xLabel: 'RB1 Rush Share (%)',
            yLabel: 'Win Percentage',
            xFormat: fmt1,
            yFormat: toPct,
            title: 'Bellcow RB vs Committee Approach',
            insight: 'Feature back (70%+) vs RBBC (50-60%). Does workhorse RB strategy win more?',
            extraInfo: d => `RB1: ${d.rb1_name} (${d.rb1_position}) - ${d.rush_distribution_style}`,
            metricHelp: '<strong>RB1 Share:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–Ω–æ—Å–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ RB –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –≤—ã–Ω–æ—Å–æ–≤. >70% = bellcow (–æ—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–∫), 50-60% = RBBC (–∫–æ–º–∏—Ç–µ—Ç), <50% = —Ä–æ—Ç–∞—Ü–∏—è.'
          },
          {
            xKey: 'top3_share',
            yKey: 'win_pct',
            xLabel: 'Top 3 Receivers Target Share (%)',
            yLabel: 'Win Percentage',
            xFormat: fmt1,
            yFormat: toPct,
            title: 'Top 3 Receiver Dominance',
            insight: 'High concentration in top 3 = star-driven offense. Low = depth & spreading the ball.',
            extraInfo: d => `Top 3: ${d.wr1_name}, ${d.wr2_name || 'N/A'}, ${d.wr3_name || 'N/A'}`,
            metricHelp: '<strong>Top 3 Share:</strong> –°—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏—ë–º–æ–≤ —Ç–æ–ø-3 –ø—Ä–∏–Ω–∏–º–∞—é—â–∏—Ö –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞. >75% = –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∑–≤—ë–∑–¥–∞—Ö, <60% = –≥–ª—É–±–æ–∫–∏–π —Å–æ—Å—Ç–∞–≤ —Å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º.'
          },
          {
            xKey: 'pass_concentration',
            yKey: 'rush_concentration',
            xLabel: 'Pass Concentration',
            yLabel: 'Rush Concentration',
            xFormat: fmt1,
            title: 'Offensive Philosophy: Concentration Strategy',
            insight: 'Top-right = star-driven (both pass & rush). Bottom-left = committee approach on both.',
            extraInfo: d => `Pass: ${d.wr1_name} | Rush: ${d.rb1_name}`,
            metricHelp: '<strong>–§–∏–ª–æ—Å–æ—Ñ–∏—è –Ω–∞–ø–∞–¥–µ–Ω–∏—è:</strong> –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –≤ –ø–∞—Å–æ–≤–æ–π –∏ –±–µ–≥–æ–≤–æ–π –∏–≥—Ä–µ. –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª = –∑–≤—ë–∑–¥–Ω–∞—è —Ç–∞–∫—Ç–∏–∫–∞, –Ω–∏–∂–Ω–∏–π –ª–µ–≤—ã–π = –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥.'
          },
          {
            xKey: 'wr_target_share',
            yKey: 'te_target_share',
            xLabel: 'WR Target Share (%)',
            yLabel: 'TE Target Share (%)',
            xFormat: fmt1,
            title: 'WR vs TE Usage Balance',
            insight: 'WR-heavy offense (high X, low Y) vs TE-heavy (low X, high Y). Strategic preference.',
            extraInfo: d => `WR1: ${d.wr1_name} | TE1: ${d.te1_name || 'N/A'}`,
            metricHelp: '<strong>–ë–∞–ª–∞–Ω—Å WR/TE:</strong> –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∏—Ä–æ–∫–∏—Ö –ø—Ä–∏–Ω–∏–º–∞—é—â–∏—Ö (WR) –ø—Ä–æ—Ç–∏–≤ —Ç–∞–π—Ç-—ç–Ω–¥–æ–≤ (TE). –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –≤ –ø–∞—Å–æ–≤–æ–π –∏–≥—Ä–µ.'
          },
          {
            xKey: 'wr1_share',
            yKey: 'top3_share',
            xLabel: 'WR1 Share (%)',
            yLabel: 'Top 3 Share (%)',
            xFormat: fmt1,
            title: 'Alpha Receiver vs Supporting Cast',
            insight: 'High both = one star + good #2/#3. High top3, low WR1 = balanced trio.',
            extraInfo: d => `Top 3: ${d.wr1_name}, ${d.wr2_name || 'N/A'}, ${d.wr3_name || 'N/A'}`,
            metricHelp: '<strong>–ê–ª—å—Ñ–∞-–ø—Ä–∏—ë–º–Ω–∏–∫:</strong> –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç WR1 –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–æ–ø-3. –í—ã—Å–æ–∫–∏–µ –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è = –æ–¥–Ω–∞ –∑–≤–µ–∑–¥–∞ + —Ö–æ—Ä–æ—à–∏–µ #2/#3. –í—ã—Å–æ–∫–∏–π —Ç–æ–ø-3, –Ω–∏–∑–∫–∏–π WR1 = —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç—Ä–∏–æ.'
          },
          {
            xKey: 'rb1_share',
            yKey: 'rb2_share',
            xLabel: 'RB1 Rush Share (%)',
            yLabel: 'RB2 Rush Share (%)',
            xFormat: fmt1,
            title: 'Running Back Committee Analysis',
            insight: 'Top-right quadrant = true RBBC (both get work). High X, low Y = clear bellcow.',
            extraInfo: d => `RB1: ${d.rb1_name} | RB2: ${d.rb2_name || 'N/A'}`,
            metricHelp: '<strong>–ö–æ–º–∏—Ç–µ—Ç RB:</strong> –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—ã–Ω–æ—Å–æ–≤ –º–µ–∂–¥—É RB1 –∏ RB2. –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π –∫–≤–∞–¥—Ä–∞–Ω—Ç = –Ω–∞—Å—Ç–æ—è—â–∏–π RBBC (–æ–±–∞ –ø–æ–ª—É—á–∞—é—Ç —Ä–∞–±–æ—Ç—É), –≤—ã—Å–æ–∫–∏–π X –Ω–∏–∑–∫–∏–π Y = —è–≤–Ω—ã–π bellcow.'
          },
          {
            xKey: 'wr1_share',
            yKey: 'pass_int_pct',
            xLabel: 'WR1 Target Share (%)',
            yLabel: 'INT Rate (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Star WR Dependency vs Interception Risk',
            insight: 'Does forcing the ball to one receiver make passing predictable? Check if high WR1 usage = more INTs.',
            metricHelp: '<strong>INT Rate:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–≤ –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –ø–µ—Ä–µ–¥–∞—á. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –ø—Ä–∏–≤–æ–¥–∏—Ç –ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ–¥–Ω–æ–≥–æ WR –∫ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –ø–µ—Ä–µ–¥–∞—á–∞–º –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞–º.',
            extraInfo: d => `WR1: ${d.wr1_name} - ${fmt2(d.pass_int_pct)}% INT rate`
          },
          {
            xKey: 'rb1_share',
            yKey: 'rush_broken_tackle_rate',
            xLabel: 'RB1 Rush Share (%)',
            yLabel: 'Broken Tackles per Rush (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Bellcow Power: Workload vs Physicality',
            insight: 'Do feature backs break more tackles because they\'re elite, or do committees stay fresher?',
            extraInfo: d => `RB1: ${d.rb1_name} - ${fmt2(d.rush_broken_tackle_rate)}% broken tackle rate`
          },
          {
            xKey: 'pass_concentration',
            yKey: 'sack_rate',
            xLabel: 'Pass Concentration Index',
            yLabel: 'Sack Rate (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Predictability Tax: Target Concentration vs Sacks',
            insight: 'Concentrated passing = defenders know where ball goes = more pressure? Or is it just bad O-lines?',
            extraInfo: d => `WR1: ${d.wr1_name} - ${fmt2(d.sack_rate)}% sack rate`,
            metricHelp: '<strong>Sack Rate:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç —Å—ç–∫–æ–≤ –æ—Ç (–ø–æ–ø—ã—Ç–∫–∏ + —Å—ç–∫–∏). –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–∏—ë–º–Ω–∏–∫–µ = –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å = –±–æ–ª—å—à–µ —Å—ç–∫–æ–≤?'
          },
          {
            xKey: 'te_target_share',
            yKey: 'sack_rate',
            xLabel: 'TE Target Share (%)',
            yLabel: 'Sack Rate (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• TE Usage: Weapon or Safety Blanket?',
            insight: 'High TE usage with low sacks = protection weapon. High TE + high sacks = last resort checkdown.',
            extraInfo: d => `TE1: ${d.te1_name || 'N/A'} - ${fmt2(d.sack_rate)}% sack rate`,
            metricHelp: '<strong>TE + Sacks:</strong> –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TE —Å –Ω–∏–∑–∫–∏–º–∏ —Å—ç–∫–∞–º–∏ = –æ—Ä—É–∂–∏–µ –∑–∞—â–∏—Ç—ã. –í—ã—Å–æ–∫–∏–µ –æ–±–∞ = –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º.'
          },
          {
            xKey: 'top3_share',
            yKey: 'yds_per_play',
            xLabel: 'Top 3 Target Share (%)',
            yLabel: 'Yards per Play',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Star Power vs Offensive Efficiency',
            insight: 'Elite receivers unlock efficiency? Or does spreading it around keep defenses honest?',
            extraInfo: d => `Top 3: ${d.wr1_name}, ${d.wr2_name || 'N/A'}, ${d.wr3_name || 'N/A'}`,
            metricHelp: '<strong>Yards per Play:</strong> –°—Ä–µ–¥–Ω–∏–µ —è—Ä–¥—ã –∑–∞ —Ä–æ–∑—ã–≥—Ä—ã—à. –≠–ª–∏—Ç–Ω—ã–µ –ø—Ä–∏—ë–º–Ω–∏–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º—è—á–∞ –¥–µ—Ä–∂–∏—Ç –∑–∞—â–∏—Ç—É –≤ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏?'
          },
          {
            xKey: 'rush_concentration',
            yKey: 'rush_yds_per_att',
            xLabel: 'Rush Concentration Index',
            yLabel: 'Rush Yards per Attempt',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Bellcow Effectiveness Test',
            insight: 'Does feeding one back work? Or do fresh legs from RBBC produce better yards per carry?',
            extraInfo: d => `RB1: ${d.rb1_name} - ${fmt2(d.rush_yds_per_att)} Y/A`,
            metricHelp: '<strong>Rush Y/A:</strong> –Ø—Ä–¥—ã –∑–∞ –≤—ã–Ω–æ—Å. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: –æ–¥–∏–Ω –±–µ–≥—É–Ω vs —Å–≤–µ–∂–∏–µ –Ω–æ–≥–∏ –∫–æ–º–∏—Ç–µ—Ç–∞ - –∫—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –±–æ–ª—å—à–µ —è—Ä–¥–æ–≤?'
          },
          {
            xKey: 'wr1_share',
            yKey: 'qb_rating',
            xLabel: 'WR1 Target Share (%)',
            yLabel: 'QB Rating',
            xFormat: fmt1,
            yFormat: fmt1,
            title: 'üí• Star WR Impact on QB Performance',
            insight: 'Elite WR1 elevates QB play? Or does elite QB make his WR1 look great? Chicken or egg?',
            metricHelp: '<strong>QB Rating:</strong> –†–µ–π—Ç–∏–Ω–≥ –∫–≤–æ—Ç–µ—Ä–±–µ–∫–∞. –≠–ª–∏—Ç–Ω—ã–π WR1 –ø–æ–≤—ã—à–∞–µ—Ç –∏–≥—Ä—É QB –∏–ª–∏ —ç–ª–∏—Ç–Ω—ã–π QB –¥–µ–ª–∞–µ—Ç WR1 –∑–≤–µ–∑–¥–æ–π? –ö—É—Ä–∏—Ü–∞ –∏–ª–∏ —è–π—Ü–æ?',
            extraInfo: d => `${d.wr1_name}: ${fmt1(d.wr1_share)}% share ‚Üí ${fmt1(d.qb_rating)} QB rating`
          },
          {
            xKey: 'rb_target_share',
            yKey: 'pass_yds_per_att',
            xLabel: 'RB Target Share (%)',
            yLabel: 'Pass Yards per Attempt',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• RB Checkdown Strategy: Smart or Desperate?',
            insight: 'High RB targets + high Y/A = designed weapon. High RB targets + low Y/A = QB under pressure dumping off.',
            extraInfo: d => `RB1: ${d.rb1_name} - ${fmt2(d.pass_yds_per_att)} Y/A`,
            metricHelp: '<strong>Pass Y/A:</strong> –Ø—Ä–¥—ã –∑–∞ –ø–æ–ø—ã—Ç–∫—É –ø–∞—Å–∞. –í—ã—Å–æ–∫–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ RB + –≤—ã—Å–æ–∫–∏–π Y/A = –æ—Ä—É–∂–∏–µ. –í—ã—Å–æ–∫–∏–µ RB + –Ω–∏–∑–∫–∏–π Y/A = —Å–±—Ä–æ—Å –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º.'
          },
          {
            xKey: 'pass_concentration',
            yKey: 'explosive_plays_per_game',
            xLabel: 'Pass Concentration Index',
            yLabel: 'Explosive Plays (20+) per Game',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Distribution Strategy vs Big Plays',
            insight: 'Does spreading the ball create more explosive opportunities? Or do stars make the big plays?',
            extraInfo: d => `WR1: ${d.wr1_name} - ${fmt2(d.explosive_plays_per_game)} explosive plays/game`,
            metricHelp: '<strong>Explosive Plays:</strong> –†–æ–∑—ã–≥—Ä—ã—à–∏ 20+ —è—Ä–¥–æ–≤ –∑–∞ –∏–≥—Ä—É. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º—è—á–∞ —Å–æ–∑–¥–∞—ë—Ç –±–æ–ª—å—à–µ –≤–∑—Ä—ã–≤–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ –∑–≤—ë–∑–¥—ã –¥–µ–ª–∞—é—Ç –±–æ–ª—å—à–∏–µ –∏–≥—Ä—ã?'
          },
          {
            xKey: 'rush_concentration',
            yKey: 'total_turnovers',
            xLabel: 'Rush Concentration Index',
            yLabel: 'Total Turnovers',
            xFormat: fmt1,
            yFormat: fmt1,
            title: 'üí• Ball Security: Bellcow vs Committee',
            insight: 'Feature backs fumble more from fatigue? Or do committees have worse ball security?',
            extraInfo: d => `RB1: ${d.rb1_name} | RB2: ${d.rb2_name || 'N/A'}`,
            metricHelp: '<strong>Turnovers:</strong> –û–±—â–∏–µ –ø–æ—Ç–µ—Ä–∏ –º—è—á–∞. –û—Å–Ω–æ–≤–Ω—ã–µ –±–µ–≥—É–Ω—ã —Ç–µ—Ä—è—é—Ç –±–æ–ª—å—à–µ –æ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏–ª–∏ —É –∫–æ–º–∏—Ç–µ—Ç–æ–≤ —Ö—É–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—å –º—è—á–∞?'
          },
          {
            xKey: 'wr_target_share',
            yKey: 'pass_td_pct',
            xLabel: 'WR Target Share (%)',
            yLabel: 'Pass TD Rate (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• WR-Heavy Offense Scoring Efficiency',
            insight: 'WR-centric attacks score more TDs? Or are TEs/RBs better in the red zone?',
            extraInfo: d => `WR1: ${d.wr1_name} | TE1: ${d.te1_name || 'N/A'}`,
            metricHelp: '<strong>Pass TD Rate:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç —Ç–∞—á–¥–∞—É–Ω–æ–≤ –æ—Ç –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–¥–∞—á. WR-—Ü–µ–Ω—Ç—Ä–∏—á–Ω—ã–µ –∞—Ç–∞–∫–∏ –∑–∞–±–∏–≤–∞—é—Ç –±–æ–ª—å—à–µ TD –∏–ª–∏ TE/RB –ª—É—á—à–µ –≤ –∫—Ä–∞—Å–Ω–æ–π –∑–æ–Ω–µ?'
          },
          {
            xKey: 'te_target_share',
            yKey: 'pass_comp_pct',
            xLabel: 'TE Target Share (%)',
            yLabel: 'Completion Percentage',
            xFormat: fmt1,
            yFormat: fmt1,
            title: 'üí• TE Usage: High-Percentage Safety Valve',
            insight: 'TEs are easier throws = higher completion %? Proof that TEs are the ultimate security blanket.',
            extraInfo: d => `TE1: ${d.te1_name || 'N/A'} - ${fmt1(d.pass_comp_pct)}% comp`,
            metricHelp: '<strong>Completion %:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞—á. TE = –±–æ–ª–µ–µ –ª—ë–≥–∫–∏–µ –±—Ä–æ—Å–∫–∏ = –≤—ã—à–µ –ø—Ä–æ—Ü–µ–Ω—Ç? –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ, —á—Ç–æ TE - ultimate –ø–æ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.'
          },
          {
            xKey: 'top3_share',
            yKey: 'turnover_diff',
            xLabel: 'Top 3 Target Share (%)',
            yLabel: 'Turnover Differential',
            xFormat: fmt1,
            yFormat: fmt1,
            title: 'üí• Star Receivers & Ball Protection',
            insight: 'Elite receivers protect the ball better? Or are teams with top WRs just better overall?',
            extraInfo: d => `Top 3: ${d.wr1_name}, ${d.wr2_name || 'N/A'}, ${d.wr3_name || 'N/A'}`,
            metricHelp: '<strong>Turnover Diff:</strong> –†–∞–∑–Ω–∏—Ü–∞ –ø–æ—Ç–µ—Ä—å –º—è—á–∞ (–æ—Ç–±–æ—Ä—ã - –æ—Ç–¥–∞—á–∏). –≠–ª–∏—Ç–Ω—ã–µ –ø—Ä–∏—ë–º–Ω–∏–∫–∏ –ª—É—á—à–µ –∑–∞—â–∏—â–∞—é—Ç –º—è—á –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã —Å —Ç–æ–ø-WR –ø—Ä–æ—Å—Ç–æ –ª—É—á—à–µ –≤ —Ü–µ–ª–æ–º?'
          },
          {
            xKey: 'rb1_share',
            yKey: 'rush_td_pct',
            xLabel: 'RB1 Rush Share (%)',
            yLabel: 'Rush TD Rate (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Goal Line Back: Who Gets the Glory?',
            insight: 'Bellcows dominate goal-line work? Or do committees rotate in fresh power backs for TDs?',
            extraInfo: d => `RB1: ${d.rb1_name} | RB2: ${d.rb2_name || 'N/A'}`,
            metricHelp: '<strong>Rush TD Rate:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç —Ç–∞—á–¥–∞—É–Ω–æ–≤ –æ—Ç –≤—ã–Ω–æ—Å–æ–≤. Bellcow –¥–æ–º–∏–Ω–∏—Ä—É—é—Ç –Ω–∞ –ª–∏–Ω–∏–∏ –≤–æ—Ä–æ—Ç –∏–ª–∏ –∫–æ–º–∏—Ç–µ—Ç—ã —Ä–æ—Ç–∏—Ä—É—é—Ç —Å–∏–ª–æ–≤—ã—Ö –±–µ–≥—É–Ω–æ–≤ –¥–ª—è TD?'
          },
          {
            xKey: 'pass_concentration',
            yKey: 'drop_rate',
            xLabel: 'Pass Concentration Index',
            yLabel: 'Drop Rate (%)',
            xFormat: fmt1,
            yFormat: fmt2,
            title: 'üí• Target Overload: Does WR1 Drop More?',
            insight: 'Feeding one receiver = more drops from fatigue? Or do elite WRs have better hands?',
            extraInfo: d => `WR1: ${d.wr1_name} - ${fmt2(d.drop_rate)}% drop rate`,
            metricHelp: '<strong>Drop Rate:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞—á –æ—Ç —Ü–µ–ª–µ–π. –ö–æ—Ä–º–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏—ë–º–Ω–∏–∫–∞ = –±–æ–ª—å—à–µ –ø–æ—Ç–µ—Ä—å –æ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏–ª–∏ —É —ç–ª–∏—Ç–Ω—ã—Ö WR –ª—É—á—à–µ —Ä—É–∫–∏?'
          },
          {
            xKey: 'rb_target_share',
            yKey: 'rec_yac_pct',
            xLabel: 'RB Target Share (%)',
            yLabel: 'YAC % (of receiving yards)',
            xFormat: fmt1,
            yFormat: fmt1,
            title: 'üí• RB Receptions: YAC Machines or Dump-offs?',
            insight: 'High RB targets + high YAC% = dynamic weapons. High RB + low YAC% = desperation checkdowns at LOS.',
            extraInfo: d => `RB1: ${d.rb1_name} - ${fmt1(d.rec_yac_pct)}% YAC`,
            metricHelp: '<strong>YAC %:</strong> –ü—Ä–æ—Ü–µ–Ω—Ç —è—Ä–¥–æ–≤ –ø–æ—Å–ª–µ –ø—Ä–∏—ë–º–∞. –í—ã—Å–æ–∫–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ RB + –≤—ã—Å–æ–∫–∏–π YAC% = –¥–∏–Ω–∞–º–∏—á–Ω–æ–µ –æ—Ä—É–∂–∏–µ. –í—ã—Å–æ–∫–∏–π RB + –Ω–∏–∑–∫–∏–π YAC% = —Å–±—Ä–æ—Å –Ω–∞ –ª–∏–Ω–∏–∏.'
          }
        ];

        const root = d3.select('#root');
        const sel = d3.select('#conf');

        function redraw() {
          const conf = sel.node().value;
          root.selectAll('*').remove();
          const filtered = conf === 'ALL' ? allRows : allRows.filter(d => d.conference === conf);
          charts.forEach(cfg => drawScatter(root, filtered, cfg));
        }

        sel.on('change', redraw);
        redraw();
      });
    }

    document.addEventListener('DOMContentLoaded', render);
  </script>
</head>
<body>
  <div class="container">
    <h1>Team Player Usage Patterns</h1>
    <div class="subtitle">
      25 graphs combining player usage distribution with team performance. Red = above trend, Blue = below trend.
      Reveals star-driven vs committee approaches and their impact on efficiency, turnovers, and scoring.
    </div>
    <div class="controls">
      <label for="conf">Conference:</label>
      <select id="conf">
        <option value="ALL" selected>All Conferences</option>
        <option value="AFC">AFC only</option>
        <option value="NFC">NFC only</option>
      </select>
    </div>
    <div class="info">
      <strong>Usage Patterns Explained:</strong>
      <ul style="margin: 6px 0 0; padding-left: 20px; line-height: 1.6;">
        <li><strong>Star-Driven</strong>: High concentration (Herfindahl > 1500) - One dominant player gets majority of touches</li>
        <li><strong>Balanced</strong>: Moderate concentration (1000-1500) - Feature player with solid supporting cast</li>
        <li><strong>Committee/Spread</strong>: Low concentration (< 1000) - Multiple players share workload evenly</li>
        <li><strong>Bellcow RB</strong>: RB1 gets 70%+ of rushes - Traditional workhorse back</li>
        <li><strong>RBBC (Running Back By Committee)</strong>: RB1 < 60%, RB2 > 25% - Split backfield</li>
      </ul>
    </div>
    <div id="root"></div>
  </div>
</body>
</html>
