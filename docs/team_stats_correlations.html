<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team Statistics — Interesting Correlations</title>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <style>
    :root {
      --red: #ef4444;
      --blue: #0ea5e9;
      --grid: #e8eaed;
      --axis: #9aa0a6;
      --text: #222;
    }
    body { margin: 16px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text); background: #f7f7f7; }
    .container { max-width: 1200px; margin: 0 auto; background: #fff; border: 1px solid #e5e5e5; border-radius: 10px; padding: 12px 16px 22px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    .subtitle { color: #666; font-size: 13px; margin: 4px 0 12px; }
    .controls { display: flex; align-items: center; gap: 10px; margin: 6px 0 8px; }
    .panel { margin: 12px 0 14px; border: 1px solid #e5e5e5; border-radius: 10px; overflow: hidden; background: #fff; }
    .panel > summary { padding: 10px 14px; background: #f5f7fa; border-bottom: 1px solid #ebeff5; font-weight: 600; cursor: pointer; user-select: none; list-style: none; }
    .panel[open] > summary { border-bottom-color: #e6eaf0; }
    .chart-wrap { padding: 8px 8px 0; }
    .legend { display: flex; align-items: center; gap: 16px; color: #555; font-size: 12px; padding: 0 10px 10px; }
    .swatch { display: inline-block; width: 12px; height: 12px; border-radius: 2px; margin-right: 6px; vertical-align: middle; }
    .avg { background: repeating-linear-gradient(90deg, #bbb, #bbb 2px, transparent 2px, transparent 6px); border: 1px solid #bbb; }
    .red { background: var(--red); opacity: .5; }
    .blue { background: var(--blue); opacity: .5; }
    .tooltip { position: absolute; pointer-events: none; background: rgba(0,0,0,.78); color: #fff; padding: 6px 8px; border-radius: 6px; font-size: 12px; z-index: 10; }
    .info { background: #f3f6fa; border: 1px solid #e1e7ef; border-radius: 8px; padding: 10px 14px; color: #243246; font-size: 14px; margin: 8px 0 12px; }
    .info summary { font-weight: 600; cursor: pointer; }
    .correlation-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
    .corr-strong { background: #dcfce7; color: #166534; }
    .corr-moderate { background: #fef3c7; color: #854d0e; }
    .corr-weak { background: #fee2e2; color: #991b1b; }
    .help-icon { display: inline-block; width: 16px; height: 16px; border-radius: 50%; background: #3b82f6; color: white; text-align: center; line-height: 16px; font-size: 11px; font-weight: bold; margin-left: 8px; cursor: help; vertical-align: middle; }
    .metric-tooltip { position: absolute; pointer-events: none; background: rgba(30,64,175,.95); color: #fff; padding: 8px 12px; border-radius: 6px; font-size: 12px; z-index: 100; max-width: 350px; line-height: 1.5; box-shadow: 0 4px 6px rgba(0,0,0,.3); }
  </style>
  <script>
    async function tryCsv(paths) {
      let lastErr;
      for (const p of paths) {
        try { return await d3.csv(p, d3.autoType); } catch (e) { lastErr = e; }
      }
      throw lastErr || new Error('Unable to load CSV: ' + paths.join(', '));
    }

    function fmt2(x) { return d3.format('.2f')(x); }
    function fmt3(x) { return d3.format('.3f')(x); }
    function toPct(x) { return d3.format('.1%')(x); }

    function regression(points) {
      let n = 0, sx = 0, sy = 0, sxy = 0, sxx = 0, syy = 0;
      for (const [x0, y0] of points) {
        const x = +x0, y = +y0;
        if (!Number.isFinite(x) || !Number.isFinite(y)) continue;
        n++; sx += x; sy += y; sxy += x*y; sxx += x*x; syy += y*y;
      }
      if (n < 2) return { m: 0, b: sy / (n || 1), r2: 0 };
      const denom = n * sxx - sx * sx;
      const m = denom !== 0 ? (n * sxy - sx * sy) / denom : 0;
      const b = (sy - m * sx) / n;
      
      const ssr = points.reduce((sum, [x0, y0]) => {
        const x = +x0, y = +y0;
        if (!Number.isFinite(x) || !Number.isFinite(y)) return sum;
        return sum + Math.pow(y - (m * x + b), 2);
      }, 0);
      const sst = syy - (sy * sy) / n;
      const r2 = sst !== 0 ? Math.max(0, 1 - ssr / sst) : 0;
      
      return { m, b, r2 };
    }

    async function loadData() {
      const stats = await tryCsv([
        '../output/team_aggregated_stats.csv',
        'output/team_aggregated_stats.csv',
        '/output/team_aggregated_stats.csv'
      ]);

      for (const row of stats) {
        row.logoUrl = (row.logoId !== '' && row.logoId != null) ? 
          `https://cdn.neonsportz.com/teamlogos/256/${row.logoId}.png` : null;
      }

      return stats;
    }

    function drawScatter(holder, rows, cfg) {
      const data = rows.filter(d => 
        Number.isFinite(+d[cfg.xKey]) && Number.isFinite(+d[cfg.yKey])
      );

      if (data.length < 2) return;

      const margin = { top: 20, right: 24, bottom: 46, left: 70 };
      const width = 1080, height = 480;
      const innerW = width - margin.left - margin.right;
      const innerH = height - margin.top - margin.bottom;

      const panel = holder.append('details').attr('class', 'panel').attr('open', true);
      const summary = panel.append('summary');
      summary.append('span').text(cfg.title);
      
      if (cfg.metricHelp) {
        const helpIcon = summary.append('span').attr('class', 'help-icon').text('?');
        const metricTip = d3.select('body').append('div').attr('class', 'metric-tooltip').style('display', 'none');
        helpIcon.on('mouseenter', function(evt) {
          metricTip.style('display', 'block').html(cfg.metricHelp);
        }).on('mousemove', (evt) => {
          metricTip.style('left', (evt.pageX + 12) + 'px').style('top', (evt.pageY - 28) + 'px');
        }).on('mouseleave', () => {
          metricTip.style('display', 'none');
        });
      }
      
      const wrap = panel.append('div').attr('class', 'chart-wrap');
      const svg = wrap.append('svg').attr('width', width).attr('height', height);
      const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

      const yVals = data.map(d => +d[cfg.yKey]);
      const yMin = d3.min(yVals), yMax = d3.max(yVals);
      const yRange = yMax - yMin;
      const yPad = yRange * 0.15 || 0.5;
      const y = d3.scaleLinear()
        .domain([yMin - yPad, yMax + yPad])
        .range([innerH, 0]);

      const xVals = data.map(d => +d[cfg.xKey]);
      const xMin = d3.min(xVals), xMax = d3.max(xVals);
      const xRange = xMax - xMin;
      const xPad = xRange * 0.15 || 0.5;
      const x = d3.scaleLinear()
        .domain([xMin - xPad, xMax + xPad])
        .range([0, innerW]);

      g.append('g').attr('transform', `translate(0,${innerH})`)
        .call(d3.axisBottom(x).ticks(10).tickFormat(cfg.xFormat || fmt2).tickSize(-innerH).tickPadding(8))
        .call(s => s.selectAll('.tick line').attr('stroke', '#e2e2e2'))
        .call(s => s.select('.domain').attr('stroke', '#9aa0a6'));

      g.append('g')
        .call(d3.axisLeft(y).ticks(10).tickFormat(cfg.yFormat || fmt2).tickSize(-innerW).tickPadding(6))
        .call(s => s.selectAll('.tick line').attr('stroke', '#efefef'))
        .call(s => s.select('.domain').attr('stroke', '#dcdcdc'));

      const yAvg = d3.mean(yVals), xAvg = d3.mean(xVals);
      g.append('line').attr('x1', 0).attr('x2', innerW).attr('y1', y(yAvg)).attr('y2', y(yAvg))
        .attr('stroke', '#999').attr('stroke-dasharray', '6,4').attr('stroke-width', 1.5);
      g.append('line').attr('x1', x(xAvg)).attr('x2', x(xAvg)).attr('y1', 0).attr('y2', innerH)
        .attr('stroke', '#9aa0a6').attr('stroke-dasharray', '6,4').attr('stroke-width', 1.5);
      g.append('text').attr('x', 6).attr('y', y(yAvg)-6).attr('fill', '#555').attr('font-size', 11)
        .text('Avg Y: ' + (cfg.yFormat || fmt2)(yAvg));
      g.append('text').attr('x', x(xAvg)+6).attr('y', 12).attr('fill', '#555').attr('font-size', 11)
        .text('Avg X: ' + (cfg.xFormat || fmt2)(xAvg));

      const { m, b, r2 } = regression(data.map(d => [+d[cfg.xKey], +d[cfg.yKey]]));
      const xRangePts = [d3.min(xVals), d3.max(xVals)];
      g.append('line')
        .attr('x1', x(xRangePts[0])).attr('y1', y(m*xRangePts[0] + b))
        .attr('x2', x(xRangePts[1])).attr('y2', y(m*xRangePts[1] + b))
        .attr('stroke', '#777').attr('stroke-width', 2).attr('opacity', .95);

      const tip = d3.select('body').append('div').attr('class', 'tooltip').style('display', 'none');

      const size = 30;
      const node = g.selectAll('.team').data(data, d => d.team).join('g').attr('class', 'team')
        .attr('transform', d => `translate(${x(d[cfg.xKey])},${y(d[cfg.yKey])})`)
        .on('mouseenter', function(evt, d){
          const trend = m * d[cfg.xKey] + b;
          const res = d[cfg.yKey] - trend;
          let html = `<strong>${d.team}</strong><br>`;
          html += `${cfg.xLabel}: ${(cfg.xFormat || fmt2)(d[cfg.xKey])}<br>`;
          html += `${cfg.yLabel}: ${(cfg.yFormat || fmt2)(d[cfg.yKey])}<br>`;
          html += `Win%: ${toPct(d.win_pct)}<br>`;
          html += `Δ vs trend: ${(res>=0?'+':'') + fmt2(res)}<br>`;
          
          const qx = +d[cfg.xKey] >= xAvg;
          const qy = +d[cfg.yKey] >= yAvg;
          let quadrant = '';
          if (cfg.quadrantHelp) {
            if (qx && qy) quadrant = '<em>' + cfg.quadrantHelp.topRight + '</em>';
            else if (!qx && qy) quadrant = '<em>' + cfg.quadrantHelp.topLeft + '</em>';
            else if (!qx && !qy) quadrant = '<em>' + cfg.quadrantHelp.bottomLeft + '</em>';
            else quadrant = '<em>' + cfg.quadrantHelp.bottomRight + '</em>';
          } else {
            if (qx && qy) quadrant = '<em>Правый верхний: высокий X, высокий Y</em>';
            else if (!qx && qy) quadrant = '<em>Левый верхний: низкий X, высокий Y</em>';
            else if (!qx && !qy) quadrant = '<em>Левый нижний: низкий X, низкий Y</em>';
            else quadrant = '<em>Правый нижний: высокий X, низкий Y</em>';
          }
          html += quadrant;
          
          tip.style('display','block').html(html);
        })
        .on('mousemove', (evt)=> tip.style('left', (evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px'))
        .on('mouseleave', ()=> tip.style('display','none'));

      node.append('rect')
        .attr('x', -(size/2 + 2)).attr('y', -(size/2 + 2))
        .attr('width', size + 4).attr('height', size + 4)
        .attr('rx', 4).attr('ry', 4)
        .attr('fill', d => (+d[cfg.yKey] >= m*+d[cfg.xKey] + b) ? 'var(--red)' : 'var(--blue)')
        .attr('opacity', .16);

      node.append('image')
        .attr('href', d => d.logoUrl || null)
        .attr('x', -size/2).attr('y', -size/2)
        .attr('width', size).attr('height', size)
        .attr('opacity', .95);

      svg.append('text').attr('x', margin.left + innerW/2).attr('y', height-10)
        .attr('text-anchor', 'middle').attr('fill', '#444').attr('font-size', 12)
        .text(cfg.xLabel);
      svg.append('text').attr('transform', `translate(14, ${margin.top + innerH/2}) rotate(-90)`)
        .attr('text-anchor', 'middle').attr('fill', '#444').attr('font-size', 12)
        .text(cfg.yLabel);

      const legend = panel.append('div').attr('class', 'legend');
      legend.append('span').html(`<span class="swatch avg"></span>Avg X & Y`);
      legend.append('span').html(`<span class="swatch red"></span>Above trend`);
      legend.append('span').html(`<span class="swatch blue"></span>Below trend`);
      legend.append('span').style('margin-left','16px').text('Trend line in gray');

      let corrClass = 'corr-weak', corrLabel = 'Weak';
      if (r2 >= 0.5) { corrClass = 'corr-strong'; corrLabel = 'Strong'; }
      else if (r2 >= 0.25) { corrClass = 'corr-moderate'; corrLabel = 'Moderate'; }
      
      summary.append('span').attr('class', `correlation-badge ${corrClass}`)
        .style('margin-left', '12px')
        .html(`R²=${fmt3(r2)} (${corrLabel})`);

      if (cfg.insight) {
        panel.append('div').style('padding', '8px 14px 10px').style('font-size', '13px')
          .style('color', '#555').style('font-style', 'italic').text('💡 ' + cfg.insight);
      }
    }

    function render() {
      loadData().then(allRows => {
        const charts = [
          {
            xKey: 'sacks_allowed_per_game',
            yKey: 'pass_ints_per_game',
            xLabel: 'Sacks Allowed per Game',
            yLabel: 'Interceptions Thrown per Game',
            title: 'O-Line Protection vs QB Turnovers',
            insight: 'Bad pass protection forces hurried throws, leading to more interceptions',
            metricHelp: '<strong>Sacks vs INTs:</strong> Плохая защита линии = спешные броски = больше перехватов. Связывает работу O-line с ошибками QB.',
            quadrantHelp: {
              topRight: 'High sacks allowed + high interceptions: Pass protection breakdown combined with poor QB decision-making. Teams here experience multiple passing turnovers per game from pressure-induced mistakes. Requires immediate adjustment to max protection schemes or quick-release passing concepts',
              topLeft: 'Low sacks but high interceptions: Clean pocket protection yet quarterback makes poor reads. Indicates decision-making issues rather than protection problems - forcing throws into coverage despite having time. Needs improvement in progression reads and checkdown discipline',
              bottomLeft: 'Low sacks + low interceptions: Optimal pass protection and decision-making. Offensive line provides consistent pocket time while QB makes smart choices. These teams typically show high completion percentage and yards per attempt through balanced execution',
              bottomRight: 'High sacks but low interceptions: QB maintains ball security despite constant pressure. While the offensive line struggles, the quarterback effectively manages pressure through throwaway decisions. This approach is unsustainable long-term due to injury risk and potential fumbles'
            }
          },
          {
            xKey: 'def_ints',
            yKey: 'pass_ints',
            xLabel: 'Defensive Interceptions (Takeaways)',
            yLabel: 'Offensive Interceptions (Giveaways)',
            title: 'Turnover Balance — Defensive INTs vs Offensive INTs',
            insight: 'Teams in top-right = high-variance style (aggressive on both sides). Bottom-left = conservative.',
            metricHelp: '<strong>Баланс потерь:</strong> Верхний правый угол = агрессивный стиль (риск с обеих сторон). Нижний левый = консервативный контроль мяча.',
            quadrantHelp: {
              topRight: 'High defensive INTs + high offensive INTs: High-variance football with aggressive play on both sides. Defense creates turnovers through aggressive coverage while offense takes risks downfield. Results in multiple combined turnovers per game - effective strategy for underdog teams',
              topLeft: 'Low defensive INTs + high offensive INTs: Defensive backs play passive coverage while offense gives ball away frequently. Creates negative turnover differential as defense cannot compensate for offensive turnovers. Indicates imbalanced unit performance',
              bottomLeft: 'Low defensive INTs + low offensive INTs: Conservative approach on both sides. Defense plays prevent coverage while offense focuses on ball control. Games decided by field position and field goals rather than turnovers. Low-scoring affairs',
              bottomRight: 'High defensive INTs + low offensive INTs: Defense aggressively attacks passing lanes while offense protects ball through short timing routes. Creates positive turnover margin through defensive playmaking and offensive ball security. Championship formula'
            }
          },
          {
            xKey: 'pass_att_per_game',
            yKey: 'punts_per_game',
            xLabel: 'Pass Attempts per Game',
            yLabel: 'Punts per Game',
            title: 'Pass Volume vs Punting Frequency',
            insight: 'Pass-heavy teams often trail in games, leading to more 3-and-outs and punts',
            metricHelp: '<strong>Pass Attempts vs Punts:</strong> Команды с частыми передачами часто проигрывают = больше пантов. Игровая ситуация влияет на статистику.',
            quadrantHelp: {
              topRight: 'High pass attempts + high punts: Trailing game script forces pass-heavy approach but drives stall frequently. High three-and-out rate despite passing volume. Offensive line fatigue and predictable passing situations allow defense to sit in nickel/dime coverage',
              topLeft: 'Low pass attempts + high punts: Run-heavy approach failing to sustain drives. Defense stacking box against predictable run game. Short drives despite time of possession focus. Indicates inability to establish effective ground game',
              bottomLeft: 'Low pass attempts + low punts: Successful ground control offense. Dominant offensive line creates consistent rushing yards, enabling clock control and field position advantages. Play-action becomes highly effective when used. Defense wears down in fourth quarter',
              bottomRight: 'High pass attempts + low punts: Efficient modern passing attack. Quick game concepts and RPOs generate consistent yards. High third down conversion rate and red zone efficiency. Defense cannot adjust to tempo and spacing'
            }
          },
          {
            xKey: 'rush_yac_pct',
            yKey: 'rush_broken_tackle_rate',
            xLabel: 'Rush Yards After Contact %',
            yLabel: 'Broken Tackles per Rush',
            title: 'Physical Running Game — YAC% vs Broken Tackles',
            insight: 'Elite RBs break tackles AND generate yards after contact. Top-right = power runners.',
            metricHelp: '<strong>Физическая игра:</strong> Элитные RB ломают захваты И набирают ярды после контакта. Верхний правый = мощные бегуны.',
            quadrantHelp: {
              topRight: 'High YAC% + high broken tackle rate: Power running back with elite contact balance and leg drive. Consistently gains additional yards after contact. Highly effective in goal line and short yardage situations. Physical running style wears down defenses',
              topLeft: 'Low YAC% + high broken tackle rate: Elusive running style focused on avoiding initial contact through cuts and moves. When contact occurs, runner goes down quickly. Requires outside zone and sweep schemes to maximize effectiveness',
              bottomLeft: 'Low YAC% + low broken tackle rate: Offensive line losing battles at line of scrimmage. Running back regularly meets multiple defenders in backfield. Average contact point at or behind line of scrimmage. Inside zone success rate significantly below average',
              bottomRight: 'High YAC% but low broken tackle rate: Offensive line creates clean running lanes with significant yards before contact. Runner lacks power to break tackles when contacted. Effective when line dominates but vulnerable against strong defensive fronts'
            }
          },
          {
            xKey: 'turnover_diff',
            yKey: 'win_pct',
            xLabel: 'Turnover Differential',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Most Predictive Stat — Turnover Margin vs Winning',
            insight: 'Turnover differential is the single strongest predictor of wins in football',
            metricHelp: '<strong>Turnover Diff:</strong> Самый сильный предсказатель побед в футболе. Разница отборов-отдач мяча напрямую коррелирует с процентом побед.',
            quadrantHelp: {
              topRight: 'Positive turnover differential + high win percentage: Strong correlation between turnover margin and winning. Teams convert short fields after turnovers into points efficiently. Defense creates multiple takeaways per game while offense limits giveaways. Exemplifies complementary football',
              topLeft: 'Negative turnover differential but winning: Offense compensates for turnover disadvantage through high yardage production. Requires exceptional quarterback play and offensive efficiency. This model typically proves unsustainable in playoff scenarios against strong defenses',
              bottomLeft: 'Negative turnover differential + low win percentage: Multiple turnovers per game without scoring ability. Poor average starting field position for opponents. Defense faces extended time on field leading to fatigue. Fundamental issues with ball security require systematic changes',
              bottomRight: 'Positive turnover differential but losing: Creating turnovers without capitalizing through scoring. Low scoring percentage after takeaways indicates red zone inefficiency or special teams failures. Execution problems despite creating opportunities'
            }
          },
          {
            xKey: 'pass_comp_pct',
            yKey: 'rec_yds_per_catch',
            xLabel: 'Completion Percentage',
            yLabel: 'Average Yards per Catch',
            title: 'Passing Philosophy — Accuracy vs Depth',
            insight: 'High completion% + low Y/C = dink-and-dunk. Low completion% + high Y/C = vertical passing.',
            metricHelp: '<strong>Философия паса:</strong> Высокий completion% + низкие Y/C = короткие передачи. Низкий completion% + высокие Y/C = глубокий пас.',
            quadrantHelp: {
              topRight: 'High completion% + high yards per catch: Optimal passing efficiency combining accuracy with depth. Effective play-action creates deep opportunities. Quarterback processes leverage and windows efficiently. Defense cannot sit in underneath coverage. High yards per attempt through balanced attack',
              topLeft: 'Low completion% but high yards per catch: Vertical passing philosophy emphasizing contested catches and deep routes. Relies on receivers with strong catch radius and contested catch ability. Lower percentage plays but higher reward when successful',
              bottomLeft: 'Low completion% + low yards per catch: Ineffective passing attack lacking both accuracy and depth. Frequent checkdowns under pressure with poor ball placement. Defense compresses field knowing deep threat is minimal. Poor third down conversion rate',
              bottomRight: 'High completion% + low yards per catch: Short passing game emphasizing quick releases and yards after catch. High percentage throws with rapid ball distribution. Requires significant YAC production for effectiveness. Vulnerable to aggressive route jumping by defense'
            }
          },
          {
            xKey: 'rush_att_per_game',
            yKey: 'pass_yds_per_att',
            xLabel: 'Rush Attempts per Game',
            yLabel: 'Pass Yards per Attempt',
            title: 'Run Game Impact on Passing Efficiency',
            insight: 'Run-first teams unlock play-action, creating better passing opportunities',
            metricHelp: '<strong>Беговая игра:</strong> Команды с частым бегом разблокируют play-action, создавая лучшие возможности для паса.',
            quadrantHelp: {
              topRight: 'High rush attempts + high pass Y/A: Effective run game creates play-action opportunities. Linebackers must respect gaps, creating larger passing windows. High play-action success rate with bootlegs and rollouts providing easier reads. Safeties cannot quickly return to deep coverage',
              topLeft: 'Low rush attempts + high pass Y/A: Pure passing attack with minimal run game. Heavy use of multiple receiver sets spreading defense horizontally. Quick game and RPOs replace traditional running plays. Effective while pass protection holds',
              bottomLeft: 'Low rush attempts + low pass Y/A: Offensive inefficiency in both phases. Defense plays balanced coverage without fear of either threat. High rate of negative plays leading to unfavorable down and distance. Poor time of possession',
              bottomRight: 'High rush attempts but low pass Y/A: Predictable run-heavy approach without play-action effectiveness. Defense stacks box knowing pass threat is minimal. Becomes predictable by down and distance. Lacks explosive play potential'
            }
          },
          {
            xKey: 'def_sacks_per_game',
            yKey: 'def_ints_per_game',
            xLabel: 'Defensive Sacks per Game',
            yLabel: 'Defensive Interceptions per Game',
            title: 'Pass Rush vs Coverage — What Creates Turnovers?',
            insight: 'Does pressure create INTs, or does coverage give time for sacks? Both work!',
            metricHelp: '<strong>Pass Rush vs Coverage:</strong> Давление создаёт перехваты или покрытие даёт время для сэков? Оба работают!',
            quadrantHelp: {
              topRight: 'High sacks + high interceptions: Elite defense combining pass rush and coverage. Quick pressure forces hurried throws into tight coverage. High third down stop rate through defensive dominance. Defense controls game outcomes',
              topLeft: 'Low sacks but high interceptions: Coverage-driven defense creating turnovers. Tight coverage forces quarterbacks to hold ball or throw into traffic. Zone disguises create confusion and interception opportunities. Red zone interception rate particularly high',
              bottomLeft: 'Low sacks + low interceptions: Ineffective pass defense lacking both rush and coverage. Quarterbacks complete high percentage from clean pockets. Quick game attacks exploit defensive weaknesses. High third down conversion rate allowed',
              bottomRight: 'High sacks but low interceptions: Strong pass rush without coverage support. Edge rushers generate quick pressure but defensive backs play off coverage. Sacks occur before routes develop for interceptions. Vulnerable to screens and hot routes'
            }
          },
          {
            xKey: 'explosive_plays_per_game',
            yKey: 'punts_per_game',
            xLabel: '20+ Yard Plays per Game',
            yLabel: 'Punts per Game',
            title: 'Explosive Plays vs Punting',
            insight: 'Big plays sustain drives and reduce punting frequency. Explosive offense = fewer punts.',
            metricHelp: '<strong>Большие игры:</strong> Взрывные розыгрыши поддерживают драйвы и уменьшают частоту пантов. Взрывное нападение = меньше пантов.',
            quadrantHelp: {
              topRight: 'High explosive plays + high punts: Boom-or-bust offense with inconsistent execution. High explosive play rate but low overall success rate. Vertical shots create big plays but frequent three-and-outs between them. Defense adjusts successfully in second half',
              topLeft: 'Low explosive plays + high punts: Offensive inefficiency without big play ability. Defense compresses field without deep ball threat. Short average drive length with limited red zone appearances. Punter sees highest snap count on team',
              bottomLeft: 'Low explosive plays but low punts: Methodical offensive approach through sustained drives. Long drives consuming significant clock time. High third down efficiency on short distances. Ball control philosophy with extended time of possession',
              bottomRight: 'High explosive plays + low punts: Elite offensive production combining explosiveness with consistency. Explosive plays complemented by sustained drives. Critical down conversions through chunk plays. High scoring percentage on possessions'
            }
          },
          {
            xKey: 'pass_rush_ratio',
            yKey: 'win_pct',
            xLabel: 'Pass/Rush Attempt Ratio',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Game Script Analysis — Pass/Run Balance vs Wins',
            insight: 'Do teams pass because they\'re losing? Or run because they\'re winning? Causation vs correlation.',
            metricHelp: '<strong>Игровая ситуация:</strong> Команды пасуют, потому что проигрывают, или бегут, потому что выигрывают? Причинность vs корреляция.',
            quadrantHelp: {
              topRight: 'High pass ratio + high win%: Pass-first offense by strategic choice rather than necessity. Maintains high pass rate even when leading. Strong efficiency metrics support approach. Quick strike capability allows scoring from any field position',
              topLeft: 'Low pass ratio + high win%: Ground control offense dominating through physical play. Heavy rush attempts control clock and wear down defenses. Wins time of possession battle significantly. Fourth quarter dominance through defensive fatigue',
              bottomLeft: 'Low pass ratio + low win%: Ineffective run-first approach with poor yards per attempt. Cannot transition to passing game due to lack of play-action threat. Offensive philosophy lacks effectiveness in either phase',
              bottomRight: 'High pass ratio + low win%: Trailing game scripts force pass-heavy approach. Frequently behind by multiple scores at halftime. Predictable passing situations lead to high pressure rates. Statistics inflated by garbage time production'
            }
          },
          {
            xKey: 'fg_pct',
            yKey: 'win_pct',
            xLabel: 'Field Goal %',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Kicking Accuracy vs Winning',
            insight: 'Games are won by 3 points. Field goal accuracy matters more in close games.',
            metricHelp: '<strong>Field Goal %:</strong> Процент попаданий по воротам. Игры выигрываются 3 очками - точность киккера важна в близких матчах.',
            quadrantHelp: {
              topRight: 'High FG% + high win%: Reliable kicking provides crucial points in close games. High conversion rate inside normal range with strong performance from distance. Critical fourth quarter execution. These marginal points often decide close games',
              topLeft: 'Low FG% but high win%: High red zone touchdown rate minimizes field goal importance. Aggressive fourth down decisions instead of field goal attempts. Offensive efficiency compensates for kicking deficiencies through touchdown production',
              bottomLeft: 'Low FG% + low win%: Kicking game costs multiple points per game while offense cannot compensate with touchdowns. Missed field goals create negative momentum shifts. Opponents gain favorable field position after misses',
              bottomRight: 'High FG% but low win%: Strong kicking performance wasted by offensive and defensive inefficiency. Limited red zone opportunities result in long field goal attempts. Defense allows excessive points making field goals insufficient'
            }
          },
          {
            xKey: 'punt_net_avg',
            yKey: 'def_ints_per_game',
            xLabel: 'Punt Net Average (Yards)',
            yLabel: 'Defensive INTs per Game',
            title: 'Field Position Battle — Punting vs Defensive Turnovers',
            insight: 'Better punting pins opponents deep, forcing riskier throws and creating turnover opportunities.',
            metricHelp: '<strong>Punt Net vs DEF INTs:</strong> Лучший пантинг прижимает соперников глубоко, заставляя рисковать пасами и создавая перехваты.',
            quadrantHelp: {
              topRight: 'High punt net + high defensive INTs: Superior field position creates turnover opportunities. Long fields force conservative play-calling and more passing attempts. Defense capitalizes on favorable starting position with high interception rate',
              topLeft: 'Low punt net but high defensive INTs: Coverage excellence overcomes poor field position. Elite defensive backs create turnovers regardless of starting position. Pattern matching and disguised coverages generate confusion even on short fields',
              bottomLeft: 'Low punt net + low defensive INTs: Special teams failure compounds defensive struggles. Poor punt coverage or shanked punts give opponents favorable starting position. Defense cannot capitalize even when given opportunities',
              bottomRight: 'High punt net but low defensive INTs: Strong punting performance wasted by passive defense. Quality hang time and placement inside twenty not utilized. Soft coverage allows easy completions negating field position advantage'
            }
          },
          {
            xKey: 'punts_in_20_pct',
            yKey: 'def_sacks_per_game',
            xLabel: 'Punts Inside 20 (%)',
            yLabel: 'Defensive Sacks per Game',
            title: 'Special Teams Impact — Punt Placement vs Defensive Pressure',
            insight: 'Coffin-corner punts force conservative play-calling, giving pass rush more opportunities.',
            metricHelp: '<strong>Punts in 20:</strong> Панты внутрь 20 заставляют консервативный плейколлинг, давая pass rush больше возможностей.',
            quadrantHelp: {
              topRight: 'High punts inside 20% + high defensive sacks: Complementary special teams and defense. Backed up offenses forced into predictable passing situations. Limited receiver options due to max protection requirements. Creates ideal pass rush opportunities',
              topLeft: 'Low punts inside 20% but high defensive sacks: Elite pass rush performs independently of field position. High pressure rate regardless of starting position. Creative rush schemes generate pressure even from short fields',
              bottomLeft: 'Low punts inside 20% + low defensive sacks: Neither special teams nor pass rush creating pressure. Opponents execute rhythm passing from favorable field position. Average starting position near midfield provides scoring opportunities',
              bottomRight: 'High punts inside 20% but low defensive sacks: Strong punt placement not utilized by pass rush. Opponents neutralize field position disadvantage through quick game and screens. Short drops prevent sack opportunities'
            }
          },
          {
            xKey: 'total_off_tds',
            yKey: 'xp_pct',
            xLabel: 'Total Offensive Touchdowns',
            yLabel: 'Extra Point %',
            title: 'Scoring Frequency vs XP Accuracy',
            insight: 'High-scoring teams attempt more XPs. Does volume increase pressure and lead to more misses?',
            metricHelp: '<strong>TDs vs XP%:</strong> Высокорезультативные команды пытаются больше XP. Объём увеличивает давление и ведёт к большим промахам?',
            quadrantHelp: {
              topRight: 'High offensive TDs + high XP%: Elite scoring efficiency with reliable conversion. High red zone touchdown rate combined with explosive scoring plays. Consistent extra point execution maintains full scoring value. Total scoring output exceeds league averages significantly',
              topLeft: 'Low offensive TDs but high XP%: Limited touchdown production with reliable kicking when needed. Frequently settling for field goals instead of touchdowns. Extra point accuracy maintained despite low volume. Games typically decided by single score margins',
              bottomLeft: 'Low offensive TDs + low XP%: Scoring struggles compounded by conversion failures. Unable to generate touchdowns or convert when scored. Leaving points on field through missed extra points. Critical points lost in close game situations',
              bottomRight: 'High offensive TDs but low XP%: High-volume scoring with conversion issues. Offensive production undermined by extra point failures. Volume potentially creating mental pressure or fatigue. Lost points could impact playoff seeding'
            }
          },
          {
            xKey: 'sack_rate',
            yKey: 'qb_rating',
            xLabel: 'Sack Rate (%)',
            yLabel: 'QB Rating',
            title: 'QB Protection vs Efficiency',
            insight: 'Better pass protection leads to better QB performance. Measures offensive line impact on QB success.',
            metricHelp: '<strong>Sack Rate vs QB Rating:</strong> Лучшая защита паса = лучшая работа QB. Измеряет влияние O-line на успех квотербека.',
            quadrantHelp: {
              topRight: 'High sack rate + high QB rating: Quarterback maintains efficiency despite pressure. Exceptional pocket presence and scrambling ability creates extended plays. Sacks occur but explosive plays compensate between pressures. Unique skill set overcomes protection issues',
              topLeft: 'Low sack rate + high QB rating: Optimal pass protection enables elite quarterback play. Clean pockets allow progression reads and timing routes. High play-action success rate with protection. Classic pocket passing executed at high level',
              bottomLeft: 'Low sack rate + low QB rating: Protection adequate but quarterback performance poor. Missing open receivers and forcing into coverage despite time. Indicates processing or accuracy issues rather than protection problems. Mental or mechanical adjustments needed',
              bottomRight: 'High sack rate + low QB rating: Poor offensive line protection destroying quarterback performance. Internal clock disrupted and mechanics breaking down under pressure. High rates of strip sacks and intentional grounding. Confidence erosion throughout season'
            }
          },
          {
            xKey: 'def_ints_per_game',
            yKey: 'win_pct',
            xLabel: 'Defensive INTs per Game',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Defensive Turnover Creation vs Winning',
            insight: 'Defense wins championships? Creating turnovers is one of the strongest predictors of winning.',
            metricHelp: '<strong>DEF INTs vs Wins:</strong> Защита выигрывает чемпионаты? Создание перехватов - один из сильнейших предсказателей побед.',
            quadrantHelp: {
              topRight: 'High defensive INTs + high win%: Ball-hawking defense creates game-changing turnovers. Short fields after interceptions convert to significant points. Momentum swings from defensive scores and red zone takeaways. Fourth quarter interceptions seal victories',
              topLeft: 'Low defensive INTs but high win%: Offensive production compensates for lack of defensive turnovers. High scoring offense makes turnovers less critical. This model often struggles in playoffs against elite defenses',
              bottomLeft: 'Low defensive INTs + low win%: Passive defensive back play without ball disruption. High completion percentage allowed due to soft coverage. Extended defensive time on field leads to fourth quarter fatigue',
              bottomRight: 'High defensive INTs but low win%: Defense creates turnovers but offense cannot capitalize. Low scoring percentage after takeaways. Interceptions often occur in garbage time. Offensive inefficiency wastes defensive efforts'
            }
          },
          {
            xKey: 'pass_int_pct',
            yKey: 'win_pct',
            xLabel: 'Interception Rate (%)',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Ball Security vs Winning',
            insight: 'Teams that protect the ball win games. Lower INT rate = more wins.',
            metricHelp: '<strong>INT Rate vs Wins:</strong> Команды, защищающие мяч, выигрывают игры. Низкий процент перехватов = больше побед.',
            quadrantHelp: {
              topRight: 'High INT rate + high win%: Risk-taking quarterback play offset by touchdown production. Big play ability compensates for turnover negative value. This high-variance approach works in regular season but typically fails in playoffs',
              topLeft: 'Low INT rate + high win%: Ball security philosophy leads to winning. Game management approach controls clock and field position. Third down efficiency through ball control. Championship-caliber approach',
              bottomLeft: 'Low INT rate + low win%: Conservative passing without offensive production. Risk aversion leads to predictability. Defense sits on short routes knowing deep threat minimal. Lack of explosive plays limits scoring',
              bottomRight: 'High INT rate + low win%: Excessive turnovers destroying win probability. Red zone interceptions and defensive scores create negative momentum. Poor decision-making without supporting arm talent. Risk-reward balance needs recalibration'
            }
          },
          {
            xKey: 'pass_yds_per_att',
            yKey: 'rush_explosive_rate',
            xLabel: 'Pass Yards per Attempt',
            yLabel: 'Rush Explosive Play Rate (%)',
            title: 'Explosive Offense Philosophy',
            insight: 'Do teams with explosive passing also have explosive running? Or specialize in one?',
            metricHelp: '<strong>Pass vs Rush Explosives:</strong> Команды с взрывным пасом также имеют взрывной бег? Или специализируются на одном?',
            quadrantHelp: {
              topRight: 'High pass Y/A + high rush explosive rate: Elite offensive balance forcing defenses to defend entire field. Explosive plays from both run and pass on significant percentage of drives. Capable of scoring from any field position quickly',
              topLeft: 'Low pass Y/A + high rush explosive rate: Ground game specialization with explosive running plays. Outside zone schemes with speed backs creating home runs. Passing game limited to checkdowns and screens. Defenses adjust by loading box',
              bottomLeft: 'Low pass Y/A + low rush explosive rate: Methodical offensive approach without big play ability. Consistent short gains requiring extended drives for scoring. Single penalty can derail entire possession. Limited scoring potential',
              bottomRight: 'High pass Y/A + low rush explosive rate: Vertical passing attack with patient running game. Deep shots and play-action create explosive passing plays. Run game focuses on ball control between passing attempts. Effective when quarterback accurate downfield'
            }
          },
          {
            xKey: 'pass_yds_per_att',
            yKey: 'rush_yds_per_att',
            xLabel: 'Pass Yards per Attempt',
            yLabel: 'Rush Yards per Attempt',
            title: 'Offensive Efficiency Balance',
            insight: 'Balanced efficiency vs specialized offense. Top-right = elite at both. Others = one-dimensional.',
            metricHelp: '<strong>Pass Y/A vs Rush Y/A:</strong> Сбалансированная эффективность vs специализированное нападение. Верхний правый = элита в обоих.',
            quadrantHelp: {
              topRight: 'High pass Y/A + high rush Y/A: Elite offensive efficiency in both phases. Defense must respect both threats equally. High red zone touchdown rate from multiple formations. Balanced attack creates favorable matchups',
              topLeft: 'Low pass Y/A + high rush Y/A: Physical ground game dominance with limited passing. Effective rushing creates play-action opportunities. Clock control philosophy limits comeback ability. Vulnerable when trailing significantly',
              bottomLeft: 'Low pass Y/A + low rush Y/A: Offensive inefficiency in both phases. Predictable play-calling by down and distance. Scoring drives occur rarely and often by accident. Below average points per game production',
              bottomRight: 'High pass Y/A + low rush Y/A: Modern spread passing attack with minimal run game. RPOs and quick game generate high yards per attempt. Effective in shootouts but vulnerable in adverse weather. Lack of balance creates playoff liability'
            }
          },
          {
            xKey: 'td_per_play',
            yKey: 'win_pct',
            xLabel: 'Touchdowns per Play',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Red Zone Scoring Efficiency vs Winning',
            insight: 'Finishing drives with TDs (not FGs) wins games. Measures red zone effectiveness.',
            metricHelp: '<strong>TD per Play:</strong> Финиш драйвов тачдаунами (не FG) выигрывает игры. Измеряет эффективность красной зоны.',
            quadrantHelp: {
              topRight: 'High TD/play + high win%: Elite red zone efficiency converting trips to touchdowns. Multiple scoring options including fade routes, RPOs, and short yardage plays. Rarely settling for field goals. High points per game through efficiency rather than volume',
              topLeft: 'Low TD/play but high win%: Defensive-oriented victories with low-scoring games. Defense creates short fields but offense settles for field goals. Winning through field position and defensive stops. Effective in weather games',
              bottomLeft: 'Low TD/play + low win%: Red zone inefficiency killing drives inside twenty. Penalties, sacks, and drops preventing touchdown conversions. Settling for field goal attempts instead of touchdowns. Leaving significant points on field',
              bottomRight: 'High TD/play but low win%: Scoring touchdowns without winning games. Often scoring in garbage time or allowing excessive defensive points. Quick strike touchdowns but poor time of possession. Defense immediately returns field to opponent'
            }
          },
          {
            xKey: 'def_sacks_per_game',
            yKey: 'pass_comp_pct',
            xLabel: 'Defensive Sacks per Game',
            yLabel: 'Team Completion %',
            title: 'Defensive Pressure Impact',
            insight: 'Does generating sacks correlate with opponent incompletions? Pass rush vs coverage.',
            metricHelp: '<strong>DEF Sacks vs Completion%:</strong> Генерация сэков коррелирует с incompletions соперника? Pass rush vs coverage.',
            quadrantHelp: {
              topRight: 'High defensive sacks + high offensive completion%: Defense generates pressure but offense counters with quick release passing. Short routes and screens neutralize pass rush. Sacks primarily occur on obvious passing downs',
              topLeft: 'Low defensive sacks + high offensive completion%: Offensive line provides excellent protection allowing full progressions. Quarterback has time to find checkdowns and secondary options. Completion percentage inflated by extended time in pocket',
              bottomLeft: 'Low defensive sacks + low offensive completion%: Tight coverage forces contested throws without pressure. Pattern matching and disguised zones create confusion. Coverage drives incompletions rather than pass rush',
              bottomRight: 'High defensive sacks + low offensive completion%: Total defensive dominance combining rush and coverage. Quick pressure forces off-platform throws into coverage. High rates of batted passes and strip sacks. Third down conversions rarely successful'
            }
          },
          {
            xKey: 'rush_att_per_game',
            yKey: 'pass_ints_per_game',
            xLabel: 'Rush Attempts per Game',
            yLabel: 'INTs Thrown per Game',
            title: 'Ball Control Strategy',
            insight: 'Running teams protect the ball better. Time of possession = fewer risky throws = fewer turnovers.',
            metricHelp: '<strong>Rush Att vs INTs:</strong> Беговые команды лучше защищают мяч. Контроль владения = меньше рискованных бросков = меньше перехватов.',
            quadrantHelp: {
              topRight: 'High rush attempts + high interceptions: Run-heavy approach but poor play-action execution. Quarterback forcing deep shots off play-action into loaded coverage. Predictable formations telegraph intentions. Run success not translating to passing efficiency',
              topLeft: 'Low rush attempts + low interceptions: Pure passing attack with quick release and hot routes. Ball out quickly before pressure arrives. High percentage throws avoiding risky deep shots. System quarterback executing efficiently',
              bottomLeft: 'Low rush attempts + high interceptions: Pass-heavy approach with poor ball security. One-dimensional offense becomes predictable. Defense sits in passing formations. Multiple turnovers despite limited rushing threat',
              bottomRight: 'High rush attempts + low interceptions: Ball control mastery through time of possession. Play-action highly effective off balanced run-pass splits. Quarterback faces minimal pressure in obvious passing situations. Championship-caliber formula'
            }
          },
          {
            xKey: 'rec_catches',
            yKey: 'rec_yds_per_catch',
            xLabel: 'Total Receptions',
            yLabel: 'Yards per Catch',
            title: 'Receiving Efficiency vs Volume',
            insight: 'High-volume short passing (bottom-right) vs low-volume deep passing (top-left). West Coast vs vertical.',
            metricHelp: '<strong>Receptions vs Y/C:</strong> Высокообъёмный короткий пас (нижний правый) vs низкообъёмный глубокий (верхний левый). West Coast vs vertical.',
            quadrantHelp: {
              topRight: 'High catches + high Y/C: Rare combination of volume and depth in passing game. Multiple receivers averaging significant yards per catch. Spread formations stretching field vertically and horizontally. High pass attempts distributed across multiple targets',
              topLeft: 'Low catches + high Y/C: Low-volume vertical passing attack. High percentage of targets traveling downfield. Deep routes dominate route tree. Requires elite quarterback arm strength and receiver speed. High week-to-week variance',
              bottomLeft: 'Low catches + low Y/C: Inefficient passing game lacking both volume and depth. Short breaking routes without YAC generation. Defense sits on short zones. Below average passing yards per game',
              bottomRight: 'High catches + low Y/C: High-volume short passing game. Numerous completions but limited yards per reception. Ball control through volume rather than efficiency. Requires perfect execution and YAC production'
            }
          },
          {
            xKey: 'sack_rate',
            yKey: 'pass_comp_pct',
            xLabel: 'Sack Rate (%)',
            yLabel: 'Completion %',
            title: 'QB Accuracy Under Pressure',
            insight: 'Can QBs maintain accuracy when facing pressure? Mental toughness and pocket presence test.',
            metricHelp: '<strong>Sack Rate vs Completion%:</strong> QB поддерживают точность под давлением? Тест ментальной силы и работы в кармане.',
            quadrantHelp: {
              topRight: 'High sack rate + high completion%: Quarterback maintains accuracy despite pressure. Exceptional pocket presence and eye discipline under duress. Internal clock adjusted for pressure situations. Completion percentage remains high despite hits',
              topLeft: 'Low sack rate + high completion%: Optimal protection enables accurate passing. Clean pockets on majority of dropbacks allow full progressions. Deep balls and touch passes delivered on time. Classic pocket passing environment',
              bottomLeft: 'Low sack rate + low completion%: Adequate protection but poor quarterback accuracy. Missing open receivers despite clean pockets. Mechanical or processing issues evident. Requires fundamental quarterback development',
              bottomRight: 'High sack rate + low completion%: Constant pressure destroying quarterback mechanics. Internal clock disrupted leading to poor footwork. Accuracy deteriorates from anticipated contact. Confidence erosion affects overall performance'
            }
          },
          {
            xKey: 'def_forced_fum',
            yKey: 'def_fum_rec',
            xLabel: 'Fumbles Forced',
            yLabel: 'Fumbles Recovered',
            title: 'Fumble Recovery Luck',
            insight: 'Fumbles are 50/50 balls. Teams above trend = lucky, below trend = unlucky. Regression candidate.',
            metricHelp: '<strong>Forced vs Recovered:</strong> Фамблы - 50/50 мячи. Команды выше тренда = удачливые, ниже = неудачливые. Кандидаты на регрессию.',
            quadrantHelp: {
              topRight: 'High forced fumbles + high recoveries: Above-average recovery rate indicating favorable variance. Combination of strip techniques and gang tackling creates and recovers fumbles. Statistical regression likely but currently benefiting from luck',
              topLeft: 'Low forced fumbles + high recoveries: Statistical anomaly with more recoveries than forced. Potentially recovering opponent-forced fumbles or data recording issues. Unsustainable recovery rate without forcing fumbles',
              bottomLeft: 'Low forced fumbles + low recoveries: Passive tackling approach without ball disruption attempts. Defenders focused on stopping rather than stripping. Conservative defensive philosophy leaving turnovers opportunities unexploited',
              bottomRight: 'High forced fumbles + low recoveries: Creating fumbles without recovering them. Below-average recovery rate indicating negative variance. Due for positive regression toward mean recovery rate. Execution without results'
            }
          },
          {
            xKey: 'rec_catches',
            yKey: 'drop_rate',
            xLabel: 'Total Receptions',
            yLabel: 'Drop Rate (%)',
            title: 'Receiving Corps Reliability',
            insight: 'Do high-volume receivers drop more passes? Fatigue vs concentration at high workloads.',
            metricHelp: '<strong>Receptions vs Drop Rate:</strong> Принимающие с высоким объёмом теряют больше передач? Усталость vs концентрация при высоких нагрузках.',
            quadrantHelp: {
              topRight: 'High catches + high drop rate: Volume-related concentration issues appearing. Drop rate increases in fourth quarter situations. Weather conditions exacerbate problems. Fatigue affecting reliability',
              topLeft: 'Low catches + high drop rate: Poor hands regardless of volume. Drops occurring on both open and contested catches. Quarterback trust diminishing over time. Receiving corps needs significant improvement',
              bottomLeft: 'Low catches + low drop rate: Limited volume but reliable when targeted. Role players executing assignments effectively. Dependable third down targets. Consistent if not spectacular production',
              bottomRight: 'High catches + low drop rate: Elite receiving corps reliability at high volume. Maintaining concentration through heavy usage. Quarterback trust enables tight window throws. Contested catch success rate well above average'
            }
          },
          {
            xKey: 'def_deflections',
            yKey: 'def_ints',
            xLabel: 'Pass Deflections',
            yLabel: 'Defensive Interceptions',
            title: 'Defensive Playmaking',
            insight: 'Creating INTs requires getting hands on the ball first. Coverage quality indicator.',
            metricHelp: '<strong>Deflections vs INTs:</strong> Создание перехватов требует сначала достать мяч руками. Индикатор качества покрытия.',
            quadrantHelp: {
              topRight: 'High deflections + high interceptions: Elite ball skills creating turnovers. High deflection-to-interception conversion rate. Aggressive play at catch point paying dividends. Creating turnovers through both effort and execution',
              topLeft: 'Low deflections + high interceptions: Opportunistic defense capitalizing on limited chances. Reading quarterback eyes and jumping routes effectively. Quality over quantity approach to turnovers. Disguised coverages creating easy interception opportunities',
              bottomLeft: 'Low deflections + low interceptions: Coverage ineffectiveness preventing ball disruption. Defensive backs consistently out of position. Quarterbacks completing passes without challenge. Scheme or personnel changes needed',
              bottomRight: 'High deflections + low interceptions: Creating opportunities without finishing plays. Poor hands preventing interception conversions. Low deflection-to-interception rate indicates execution issues. Defensive backs need ball skills development'
            }
          },
          {
            xKey: 'rush_broken_tackles',
            yKey: 'rush_tds',
            xLabel: 'Broken Tackles (Rushing)',
            yLabel: 'Rushing Touchdowns',
            title: 'Run Game Physicality',
            insight: 'Power runners break tackles AND score TDs. Physical dominance at the goal line.',
            metricHelp: '<strong>Broken Tackles vs Rush TDs:</strong> Мощные бегуны ломают захваты И забивают TD. Физическое доминирование на линии ворот.',
            quadrantHelp: {
              topRight: 'High broken tackles + high rushing TDs: Power running dominance through contact. Elite red zone conversion rate on ground. Physical running style wearing down defenses. Short yardage and goal line success',
              topLeft: 'Low broken tackles + high rushing TDs: Scoring through speed and vision rather than power. Avoiding contact while finding end zone. Outside zone and sweep success in red zone. Scheme creating touchdown opportunities',
              bottomLeft: 'Low broken tackles + low rushing TDs: Ineffective power running game. Unable to break tackles or score on ground. Goal line struggles leading to passing or field goal attempts. Running backs going down on first contact',
              bottomRight: 'High broken tackles + low rushing TDs: Breaking tackles without scoring touchdowns. Red zone inefficiency despite physical running. Predictability or penalties killing scoring drives. Unable to finish drives with touchdowns'
            }
          },
          {
            xKey: 'punt_net_avg',
            yKey: 'win_pct',
            xLabel: 'Punt Net Average (Yards)',
            yLabel: 'Win Percentage',
            yFormat: toPct,
            title: 'Special Teams Field Position Impact',
            insight: 'Better punting creates better field position. Hidden yards that contribute to winning.',
            metricHelp: '<strong>Punt Net vs Win%:</strong> Лучший пантинг создаёт лучшую позицию поля. Скрытые ярды, которые способствуют победам.',
            quadrantHelp: {
              topRight: 'High punt net + high win%: Superior field position contributing to victories. Significant starting field position advantage each game. Complementary special teams and coverage units. Hidden yardage translating to scoring differential',
              topLeft: 'Low punt net but high win%: Winning despite poor field position. Offense and defense performance overcoming special teams deficiency. Vulnerability in close games where field position matters',
              bottomLeft: 'Low punt net + low win%: Poor field position compounding team struggles. Opponents consistently starting with short fields. Punter issues with coverage or consistency. Hidden yardage deficit affecting outcomes',
              bottomRight: 'High punt net but low win%: Elite punting performance wasted by team inefficiency. Excellent field position not converted to points. Special teams excellence without complementary unit support'
            }
          },
          {
            xKey: 'pass_att_per_game',
            yKey: 'sacks_allowed_per_game',
            xLabel: 'Pass Attempts per Game',
            yLabel: 'Sacks Allowed per Game',
            title: 'Pass Protection Breakdown Rate',
            insight: 'More dropbacks = more sacks? Pass-heavy offense fatigue on offensive line.',
            metricHelp: '<strong>Pass Att vs Sacks Allowed:</strong> Больше дропбэков = больше сэков? Усталость пасовой защиты O-line при частых пасах.',
            quadrantHelp: {
              topRight: 'High pass attempts + high sacks allowed: Volume-related protection breakdown. Offensive line fatigue from excessive pass blocking. Predictable passing situations allowing defensive adjustments. Protection deteriorating throughout game',
              topLeft: 'Low pass attempts + high sacks allowed: Poor protection regardless of volume. High sack rate even on limited attempts. Quick game ineffective at mitigating pressure. Fundamental protection issues requiring scheme or personnel changes',
              bottomLeft: 'Low pass attempts + low sacks allowed: Run-first approach preserving offensive line. Fresh protection when passing off play-action. Low sack rate from selective passing rather than elite protection',
              bottomRight: 'High pass attempts + low sacks allowed: Elite pass protection sustaining through volume. Low sack rate despite heavy passing load. Excellent communication and stunt pickup. Quarterback comfortable in pocket'
            }
          },
          {
            xKey: 'def_tackles',
            yKey: 'def_sacks',
            xLabel: 'Total Tackles',
            yLabel: 'Defensive Sacks',
            title: 'Defensive Tackle Efficiency',
            insight: 'High tackle teams chase plays. Low tackle + high sack teams make disruptive plays.',
            metricHelp: '<strong>Tackles vs Sacks:</strong> Команды с большим числом tackles гонятся за игрой. Низкие tackles + высокие sacks = разрушительные игры.',
            quadrantHelp: {
              topRight: 'High tackles + high sacks: Aggressive defense with gang tackling and pass rush. Multiple defenders to ball carrier each play. Creating negative plays through numbers and penetration. High effort but exhausting style',
              topLeft: 'Low tackles + high sacks: Disruptive defense stopping plays behind line. Tackles for loss and sacks preventing forward progress. Three-and-outs through penetration. Ultimate defensive efficiency',
              bottomLeft: 'Low tackles + low sacks: Ineffective defense with missed tackles and no pressure. Players out of position or lacking effort. High first down rate allowed. Offense controlling game flow',
              bottomRight: 'High tackles + low sacks: Reactive defense making tackles downfield. No penetration or disruption at line. Offense dictating tempo and field position. Bend-but-not-break philosophy failing'
            }
          },
          {
            xKey: 'yds_per_play',
            yKey: 'explosive_plays_per_game',
            xLabel: 'Yards per Play',
            yLabel: 'Explosive Plays (20+) per Game',
            title: 'Offensive Consistency vs Explosiveness',
            insight: 'Consistent efficient offense (left) vs boom-or-bust explosive offense (right).',
            metricHelp: '<strong>Y/Play vs Explosive Plays:</strong> Последовательное эффективное нападение (слева) vs boom-or-bust взрывное (справа).',
            quadrantHelp: {
              topRight: 'High yards/play + high explosive plays: Total offensive dominance with efficiency and explosiveness. Automatic first downs with bonus big plays. High scoring output. Defense cannot focus on any single threat',
              topLeft: 'Low yards/play + high explosive plays: Boom-or-bust offense relying on big plays. Three-and-outs between explosive gains. High variance performance week to week. Requires perfect execution on explosive opportunities',
              bottomLeft: 'Low yards/play + low explosive plays: Offensive inefficiency without big play ability. Frequent punting with minimal yardage production. Defense on field for extended time leading to fatigue',
              bottomRight: 'High yards/play + low explosive plays: Methodical offensive efficiency without big plays. Consistent gains through systematic approach. Long sustained drives controlling clock. Vulnerable to drive-killing turnovers'
            }
          },
          {
            xKey: 'total_turnovers',
            yKey: 'total_takeaways',
            xLabel: 'Turnovers (Giveaways)',
            yLabel: 'Takeaways',
            title: 'Turnover Differential Components',
            insight: 'Top-right = aggressive both ways. Bottom-left = conservative. Diagonal = turnover margin.',
            metricHelp: '<strong>Giveaways vs Takeaways:</strong> Верхний правый = агрессивность с обеих сторон. Нижний левый = консервативность. Диагональ = turnover margin.',
            quadrantHelp: {
              topRight: 'High giveaways + high takeaways: High-variance turnover game on both sides. Multiple combined turnovers each game. Success depends on converting takeaways more efficiently than opponent. Volatile game-to-game results',
              topLeft: 'Low giveaways + high takeaways: Elite turnover differential through ball security and defensive playmaking. Creating short fields while protecting possessions. Championship-caliber turnover margin when sustained',
              bottomLeft: 'Low giveaways + low takeaways: Conservative approach minimizing turnovers both ways. Low-scoring games decided by field position. Special teams importance elevated. Risk-averse philosophy',
              bottomRight: 'High giveaways + low takeaways: Severe negative turnover differential. Giving away possessions without creating them. Cannot overcome multiple possession disadvantage. Fundamental ball security issues'
            }
          },
          {
            xKey: 'rec_yac_pct',
            yKey: 'rec_yds_per_catch',
            xLabel: 'Receiving YAC %',
            yLabel: 'Yards per Catch',
            title: 'Receiving YAC Creation',
            insight: 'YAC from short passes (high YAC%, low Y/C) vs downfield catches (low YAC%, high Y/C). Scheme design.',
            metricHelp: '<strong>YAC% vs Y/C:</strong> YAC от коротких передач (высокий YAC%, низкий Y/C) vs ловля на глубине (низкий YAC%, высокий Y/C). Схема дизайна.',
            quadrantHelp: {
              topRight: 'High YAC% + high Y/C: Elite combination of downfield catching and after-catch ability. Receivers creating additional yards on all route types. Scheme and talent maximizing both air yards and YAC. Defensive matchup nightmare',
              topLeft: 'Low YAC% + high Y/C: Vertical passing attack with minimal after-catch yards. Deep completions with immediate tackles. Jump balls and contested catches downfield. Yards generated through air rather than YAC',
              bottomLeft: 'Low YAC% + low Y/C: Inefficient passing with immediate tackles. Short completions without separation or space. Defense rallying quickly to ball. Neither air yards nor YAC production',
              bottomRight: 'High YAC% + low Y/C: Scheme-based YAC production on short passes. Screens and quick game creating yards after catch. Limited air yards compensated by YAC ability. Modern short passing evolution'
            }
          }
        ];

        const root = d3.select('#root');
        const sel = d3.select('#conf');

        function redraw() {
          const conf = sel.node().value;
          root.selectAll('*').remove();
          const rows = allRows.filter(r => 
            conf === 'ALL' || (r.conference || '').toUpperCase() === conf
          );
          charts.forEach(cfg => drawScatter(root, rows, cfg));
        }

        sel.on('change', redraw);
        redraw();
      }).catch(err => {
        d3.select('#root').append('div').style('color','crimson').text('Failed to load data: '+err);
        console.error(err);
      });
    }

    window.addEventListener('DOMContentLoaded', render);
  </script>
</head>
<body>
  <div class="container">
    <h1>Team Statistics — Interesting Correlations</h1>
    <div class="subtitle">
      34 non-obvious relationships between team metrics. Red = above trend, Blue = below trend.
      R² shows correlation strength. Each graph reveals strategic insights.
    </div>
    <div class="controls">
      <label for="conf">Conference:</label>
      <select id="conf">
        <option value="ALL" selected>All Conferences</option>
        <option value="AFC">AFC only</option>
        <option value="NFC">NFC only</option>
      </select>
    </div>
    <details class="info" open>
      <summary>What These Graphs Show</summary>
      <p>
        Unlike typical "stat vs Win%" charts, these explore <strong>cross-metric relationships</strong> that reveal:
      </p>
      <ul>
        <li><strong>Causation patterns</strong>: Does bad run defense force more interceptions?</li>
        <li><strong>Strategy trade-offs</strong>: Completion% vs passing depth, aggression vs ball security</li>
        <li><strong>Hidden connections</strong>: How pass rush affects coverage, how run game unlocks passing</li>
        <li><strong>Team identity</strong>: High-variance aggressive teams vs conservative ball-control teams</li>
      </ul>
      <p>
        <strong>R² (correlation strength)</strong>: 0.0 = no relationship, 1.0 = perfect correlation.
        Strong (≥0.5) = predictive relationship. Weak (&lt;0.25) = interesting outliers to explore.
      </p>
    </details>
    <div id="root"></div>
    <div class="subtitle">Data: stats_scripts/output/team_aggregated_stats.csv</div>
  </div>
</body>
</html>
