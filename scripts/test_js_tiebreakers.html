<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript NFL Tiebreaker Tests</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .test-pass {
            background: #0e4429;
            border-left: 4px solid #26a641;
        }
        .test-fail {
            background: #5a1e1e;
            border-left: 4px solid #f85149;
        }
        .summary {
            margin: 20px 0;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 4px;
            font-size: 1.2em;
        }
        h1 { color: #58a6ff; }
        h2 { color: #8b949e; margin-top: 30px; }
    </style>
</head>
<body>
    <h1>üèà JavaScript NFL Tiebreaker Tests</h1>
    <div id="results"></div>
    <div id="summary" class="summary"></div>

    <script>
        const teamsInfo = {
            'Team A': { division: 'AFC East', conference: 'AFC', logo_url: '' },
            'Team B': { division: 'AFC East', conference: 'AFC', logo_url: '' },
            'Team C': { division: 'AFC East', conference: 'AFC', logo_url: '' },
            'Team D': { division: 'AFC East', conference: 'AFC', logo_url: '' },
            'Team X': { division: 'AFC West', conference: 'AFC', logo_url: '' },
            'Team Y': { division: 'AFC West', conference: 'AFC', logo_url: '' },
            'Team Z': { division: 'NFC East', conference: 'NFC', logo_url: '' }
        };

        function breakTwoTeamDivisionTie(teams, stats) {
            const [team1, team2] = teams;
            
            const h2h1 = stats[team1].head_to_head[team2] || { W: 0, L: 0, T: 0 };
            const h2hTotal = h2h1.W + h2h1.L + h2h1.T;
            if (h2hTotal > 0) {
                const h2h1Pct = (h2h1.W + 0.5 * h2h1.T) / h2hTotal;
                const h2h2Pct = (h2h1.L + 0.5 * h2h1.T) / h2hTotal;
                if (h2h1Pct > h2h2Pct) return { winner: team1, tiebreaker: `Head-to-head: won ${h2h1.W}-${h2h1.L}` };
                if (h2h2Pct > h2h1Pct) return { winner: team2, tiebreaker: `Head-to-head: won ${h2h1.L}-${h2h1.W}` };
            }
            
            if (stats[team1].division_pct > stats[team2].division_pct) {
                return { winner: team1, tiebreaker: `Division record: ${stats[team1].division_pct.toFixed(3)}` };
            }
            if (stats[team2].division_pct > stats[team1].division_pct) {
                return { winner: team2, tiebreaker: `Division record: ${stats[team2].division_pct.toFixed(3)}` };
            }
            
            const commonOpps = new Set(stats[team1].opponents.filter(o => stats[team2].opponents.includes(o)));
            if (commonOpps.size >= 4) {
                const common1W = stats[team1].game_results.filter(g => commonOpps.has(g.opponent) && g.pf > g.pa).length;
                const common1L = stats[team1].game_results.filter(g => commonOpps.has(g.opponent) && g.pf < g.pa).length;
                const common1T = stats[team1].game_results.filter(g => commonOpps.has(g.opponent) && g.pf === g.pa).length;
                const common1Total = common1W + common1L + common1T;
                const common1Pct = common1Total > 0 ? (common1W + 0.5 * common1T) / common1Total : 0;
                
                const common2W = stats[team2].game_results.filter(g => commonOpps.has(g.opponent) && g.pf > g.pa).length;
                const common2L = stats[team2].game_results.filter(g => commonOpps.has(g.opponent) && g.pf < g.pa).length;
                const common2T = stats[team2].game_results.filter(g => commonOpps.has(g.opponent) && g.pf === g.pa).length;
                const common2Total = common2W + common2L + common2T;
                const common2Pct = common2Total > 0 ? (common2W + 0.5 * common2T) / common2Total : 0;
                
                if (common1Pct > common2Pct) {
                    return { winner: team1, tiebreaker: `Common games: ${common1W}-${common1L}-${common1T}` };
                }
                if (common2Pct > common1Pct) {
                    return { winner: team2, tiebreaker: `Common games: ${common2W}-${common2L}-${common2T}` };
                }
            }
            
            if (stats[team1].strength_of_victory > stats[team2].strength_of_victory) {
                return { winner: team1, tiebreaker: `Strength of victory` };
            }
            if (stats[team2].strength_of_victory > stats[team1].strength_of_victory) {
                return { winner: team2, tiebreaker: `Strength of victory` };
            }
            
            return { winner: team1, tiebreaker: 'Coin toss' };
        }

        let passCount = 0;
        let failCount = 0;
        const resultsDiv = document.getElementById('results');

        function logTest(name, passed, message = '') {
            const div = document.createElement('div');
            div.className = `test-result test-${passed ? 'pass' : 'fail'}`;
            div.textContent = `${passed ? '‚úì' : '‚úó'} ${name}${message ? ': ' + message : ''}`;
            resultsDiv.appendChild(div);
            if (passed) passCount++; else failCount++;
        }

        function test_head_to_head() {
            const stats = {
                'Team A': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: { 'Team B': { W: 1, L: 0, T: 0 } },
                    opponents: [],
                    game_results: [],
                    strength_of_victory: 0.5
                },
                'Team B': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: { 'Team A': { W: 0, L: 1, T: 0 } },
                    opponents: [],
                    game_results: [],
                    strength_of_victory: 0.5
                }
            };
            
            const result = breakTwoTeamDivisionTie(['Team A', 'Team B'], stats);
            logTest('Head-to-head tiebreaker', result.winner === 'Team A', `Winner: ${result.winner}`);
        }

        function test_division_record() {
            const stats = {
                'Team A': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 4, division_L: 2, division_T: 0, division_pct: 0.667,
                    head_to_head: {},
                    opponents: [],
                    game_results: [],
                    strength_of_victory: 0.5
                },
                'Team B': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: {},
                    opponents: [],
                    game_results: [],
                    strength_of_victory: 0.5
                }
            };
            
            const result = breakTwoTeamDivisionTie(['Team A', 'Team B'], stats);
            logTest('Division record tiebreaker', result.winner === 'Team A', `Winner: ${result.winner}`);
        }

        function test_common_games() {
            const stats = {
                'Team A': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: {},
                    opponents: ['Opp1', 'Opp2', 'Opp3', 'Opp4'],
                    game_results: [
                        { opponent: 'Opp1', pf: 24, pa: 20 },
                        { opponent: 'Opp2', pf: 27, pa: 21 },
                        { opponent: 'Opp3', pf: 30, pa: 28 },
                        { opponent: 'Opp4', pf: 28, pa: 24 }
                    ],
                    strength_of_victory: 0.5
                },
                'Team B': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: {},
                    opponents: ['Opp1', 'Opp2', 'Opp3', 'Opp4'],
                    game_results: [
                        { opponent: 'Opp1', pf: 21, pa: 24 },
                        { opponent: 'Opp2', pf: 24, pa: 27 },
                        { opponent: 'Opp3', pf: 20, pa: 21 },
                        { opponent: 'Opp4', pf: 17, pa: 20 }
                    ],
                    strength_of_victory: 0.5
                }
            };
            
            const result = breakTwoTeamDivisionTie(['Team A', 'Team B'], stats);
            logTest('Common games tiebreaker (4-0 vs 0-4)', result.winner === 'Team A', `Winner: ${result.winner}`);
        }

        function test_strength_of_victory() {
            const stats = {
                'Team A': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: {},
                    opponents: [],
                    game_results: [],
                    strength_of_victory: 0.600
                },
                'Team B': {
                    W: 10, L: 7, T: 0, win_pct: 0.588,
                    division_W: 3, division_L: 3, division_T: 0, division_pct: 0.5,
                    head_to_head: {},
                    opponents: [],
                    game_results: [],
                    strength_of_victory: 0.400
                }
            };
            
            const result = breakTwoTeamDivisionTie(['Team A', 'Team B'], stats);
            logTest('Strength of victory tiebreaker', result.winner === 'Team A', `Winner: ${result.winner}`);
        }

        // Run all tests
        console.log('Running JavaScript NFL Tiebreaker Tests...');
        test_head_to_head();
        test_division_record();
        test_common_games();
        test_strength_of_victory();

        // Display summary
        const total = passCount + failCount;
        const summaryDiv = document.getElementById('summary');
        summaryDiv.innerHTML = `
            <strong>Test Summary:</strong> ${passCount}/${total} tests passed
            ${failCount > 0 ? `<br><span style="color: #f85149;">‚ö†Ô∏è ${failCount} test(s) failed</span>` : '<br><span style="color: #26a641;">‚úì All tests passed!</span>'}
        `;
        
        console.log(`Tests completed: ${passCount}/${total} passed`);
    </script>
</body>
</html>
